<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sqls xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="GlFile" longname="文件相关命名sql" package="cn.sunline.ltts.busi.gl.namedsql" xsi:noNamespaceSchemaLocation="ltts-model.xsd">
    <select cache="none" method="selectAll" type="sql" id="lstFileLoanDown" longname="文件下载">
        <sql type="oracle"><![CDATA[select
    	    	a.busi_batch_code, b.file_id ,b.file_name ,b.file_local_path ,c.sys_no
    	from
    	    	apb_batch_request a 
    	join
    	    	apb_batch_receive b 
    	on      a.request_file_id = b.file_id
			join  app_batch c
			on			a.busi_batch_id = c.busi_batch_id
    	where
                a.corpno = #org_id# 
    	    	and a.busi_batch_type = #busi_batch_type# 
    	    	and a.file_handling_status = #file_handling_status#
    	    	and b.receive_ind = #receive_ind#]]></sql>
        <sql type="db2"><![CDATA[select
    	    	a.busi_batch_code, b.file_id ,b.file_name ,b.file_local_path ,c.sys_no
    	from
    	    	apb_batch_request a 
    	join
    	    	apb_batch_receive b 
    	on      a.request_file_id = b.file_id
			join  app_batch c
			on			a.busi_batch_id = c.busi_batch_id
    	where
                a.corpno = #org_id# 
    	    	and a.busi_batch_type = #busi_batch_type# 
    	    	and a.file_handling_status = #file_handling_status#
    	    	and b.receive_ind = #receive_ind#]]></sql>
        <sql type="mysql"><![CDATA[select
    	    	a.busi_batch_code, b.file_id ,b.file_name ,b.file_local_path ,c.sys_no
    	from
    	    	apb_batch_request a 
    	join
    	    	apb_batch_receive b 
    	on      a.request_file_id = b.file_id
			join  app_batch c
			on			a.busi_batch_id = c.busi_batch_id
    	where
                a.corpno = #org_id# 
    	    	and a.busi_batch_type = #busi_batch_type# 
    	    	and a.file_handling_status = #file_handling_status#
    	    	and b.receive_ind = #receive_ind#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="busi_batch_type" ref="GlDict.A.busi_batch_type" jdbcType="VARCHAR" javaType="GlEnumType.E_BATCHTYPE" mode="in" longname="文件批量类别" parameterType="condition"/>
            <parameter property="file_handling_status" ref="GlDict.A.file_handling_status" jdbcType="VARCHAR" javaType="GlEnumType.E_FILEDEALSTATUS" mode="in" longname="文件处理状态" parameterType="condition"/>
            <parameter property="receive_ind" ref="GlDict.A.receive_ind" jdbcType="VARCHAR" javaType="GlEnumType.E_YESORNO" mode="in" longname="文件收妥标志" parameterType="condition"/>
        </parameterMap>
        <resultMap class="GlFile.GlFileLaodCom"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selFileHeadInfoFromAccure" longname="从计提表中获取文件头信息">
        <sql type="mysql"><![CDATA[
    	select
    	    	count(1) as head_total_count, ifnull(sum(a.budget_inst_amt), 0.00) as head_total_amt 
    	from
    	    	fab_accrue a 
    	where
    	    	a.corpno = #org_id# and a.accrue_date=#trxn_date# and cdcnno=#cdcnno#
    	]]></sql>
        <sql type="oracle"><![CDATA[
    	            select
    	    	count(1) as head_total_count, nvl(sum(a.budget_inst_amt), 0.00) as head_total_amt 
    	from
    	    	fab_accrue a
    	where
    	    	a.corpno = #org_id# and a.accrue_date=#trxn_date# and cdcnno=#cdcnno# ]]></sql>
        <sql type="db2"><![CDATA[
    	            select
    	    	count(1) as head_total_count, value(sum(a.budget_inst_amt), 0.00) as head_total_amt 
    	from
    	    	fab_accrue a
    	where
    	    	a.corpno = #org_id# and a.accrue_date=#trxn_date# and cdcnno=#cdcnno# ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="cdcnno" jdbcType="VARCHAR" javaType="BaseType.U_DCNNO" mode="in" longname="DCN编号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="GlFile.GlFileHead"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selFileHeadInfoFromLedger" longname="从分户账余额流水表中获取文件头信息">
        <sql type="oracle"><![CDATA[
    	select
    	    	count(1) as head_total_count, nvl(sum(a.acct_bal), 0.00) as head_total_amt 
    	from
    	    	fab_ledger_check_seq a
    	where
    	    	a.corpno = #org_id# and a.trxn_date=#trxn_date# and cdcnno=#cdcnno#
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	count(1) as head_total_count, ifnull(sum(a.acct_bal), 0.00) as head_total_amt 
    	from
    	    	fab_ledger_check_seq a 
    	where
    	    	a.corpno = #org_id# and a.trxn_date=#trxn_date# and cdcnno=#cdcnno#
    	]]></sql>
        <sql type="db2"><![CDATA[
    	select
    	    	count(1) as head_total_count, value(sum(a.acct_bal), 0.00) as head_total_amt 
    	from
    	    	fab_ledger_check_seq a
    	where
    	    	a.corpno = #org_id# and a.trxn_date=#trxn_date# and cdcnno=#cdcnno#
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="cdcnno" jdbcType="VARCHAR" javaType="BaseType.U_DCNNO" mode="in" longname="DCN编号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="GlFile.GlFileHead"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstCheckDataFromAccountingSeq" longname="计算会计事件的对账数据">
        <sql type="mysql"><![CDATA[
    	select
    	    	ifnull(sum(a.trxn_amt), 0.00) as total_amt, count(1) as record_number, a.trxn_date, 'C' as file_type,
    	    	a.accounting_subject 
    	from
    	    	fab_accounting_seq a 
    	where
    	    	a.corpno = #org_id# and a.trxn_date = #trxn_date# 
    	    	and a.sys_no=#sys_no# 
    	group by
    	    	a.accounting_subject , a.trxn_date 
    	]]></sql>
        <sql type="oracle"><![CDATA[
    	select
    	    	nvl(sum(a.trxn_amt), 0.00) as total_amt, count(1) as record_number, a.trxn_date,
    	    	'C' as file_type, a.accounting_subject 
    	from
    	    	fab_accounting_seq a 
    	where
    	    	a.corpno = #org_id# and a.trxn_date = #trxn_date# 
    	    	and a.sys_no=#sys_no# 
    	group by
    	    	a.accounting_subject , a.trxn_date 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	select
    	    	value(sum(a.trxn_amt), 0.00) as total_amt, count(1) as record_number, a.trxn_date,
    	    	'C' as file_type, a.accounting_subject 
    	from
    	    	fab_accounting_seq a 
    	where
    	    	a.corpno = #org_id# and a.trxn_date = #trxn_date# 
    	    	and a.sys_no=#sys_no# 
    	group by
    	    	a.accounting_subject , a.trxn_date 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="sys_no" ref="GlDict.A.sys_no" jdbcType="VARCHAR" javaType="GlBaseType.U_SYSNO" mode="in" longname="系统编号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="GlFile.GlCheckRecord"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstCheckDataFromAccure" longname="从计提表中查询对账数据">
        <sql type="mysql"><![CDATA[
    	select ifnull(sum(a.budget_inst_amt),0.00) as total_amt, count(1) as record_number, a.accrue_date as trxn_date, 'E' as file_type, 
    	       case when a.accrue_type = 'A' then '0'
						when a.accrue_type = 'B' then '6'
						when a.accrue_type = 'D' then '6'
						when a.accrue_type = 'T' then '8'
						else '6' end accounting_subject  
	    from 
	           fab_accrue a 
    	where
    	       a.corpno=#org_id# and a.accrue_date=#trxn_date# 
    	       and a.sys_no=#sys_no# 
    	group by
    	       accounting_subject ,a.accrue_date 
    	]]></sql>
        <sql type="oracle"><![CDATA[select nvl(sum(t1.budget_inst_amt),0.00) as total_amt, count(1) as record_number,t1.accrue_date as trxn_date,'E' as file_type,t1.accounting_subject from
(
	select a.budget_inst_amt,a.accrue_date,
		case when a.accrue_type = 'A' then '0'
		when a.accrue_type = 'B' then '6'
		when a.accrue_type = 'D' then '6'
		when a.accrue_type = 'T' then '8'
		else '6' end accounting_subject
	from fab_accrue a
	where a.corpno=#org_id# and a.accrue_date=#trxn_date# and a.sys_no=#sys_no#
) t1
group by t1.accounting_subject,t1.accrue_date]]></sql>
        <sql type="db2"><![CDATA[select value(sum(a.budget_inst_amt),0.00) as total_amt, count(1) as record_number, a.accrue_date as trxn_date, 'E' as file_type,
    	    	case when a.accrue_type = 'A' then '0'
						when a.accrue_type = 'B' then '6'
						when a.accrue_type = 'D' then '6'
						when a.accrue_type = 'T' then '8'
						else '6' end accounting_subject
    	from
    	    	fab_accrue a 
    	where
    	    	a.corpno=#org_id# and a.accrue_date=#trxn_date# 
    	    	and a.sys_no=#sys_no# 
    	group by
    	    	accounting_subject ,a.accrue_date]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="sys_no" ref="GlDict.A.sys_no" jdbcType="VARCHAR" javaType="GlBaseType.U_SYSNO" mode="in" longname="系统编号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="GlFile.GlCheckRecord"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstCheckDataFromLeger" longname="查询分户账余额对账数据">
        <sql type="mysql"><![CDATA[
    	select
    	    	ifnull(sum(a.acct_bal), 0.00) as total_amt, count(1) as record_number, a.trxn_date, 'G' as file_type,
    	    	a.accounting_subject
    	from
    	    	fab_ledger_check_seq a 
    	where
    	    	a.corpno=#org_id# and a.trxn_date=#trxn_date# 
    	    	and a.sys_no=#sys_no# 
    	group by
    	    	a.accounting_subject, a.trxn_date 
    	]]></sql>
        <sql type="oracle"><![CDATA[
    	select
    	    	nvl(sum(a.acct_bal), 0.00) as total_amt, count(1) as record_number, a.trxn_date, 'G' as file_type,
    	    	a.accounting_subject
    	from
    	    	fab_ledger_check_seq a 
    	where
    	    	a.corpno=#org_id# and a.trxn_date=#trxn_date# 
    	    	and a.sys_no=#sys_no# 
    	group by
    	    	a.accounting_subject, a.trxn_date 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	select
    	    	value(sum(a.acct_bal), 0.00) as total_amt, count(1) as record_number, a.trxn_date, 'G' as file_type,
    	    	a.accounting_subject
    	from
    	    	fab_ledger_check_seq a 
    	where
    	    	a.corpno=#org_id# and a.trxn_date=#trxn_date# 
    	    	and a.sys_no=#sys_no# 
    	group by
    	    	a.accounting_subject, a.trxn_date 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="sys_no" ref="GlDict.A.sys_no" jdbcType="VARCHAR" javaType="GlBaseType.U_SYSNO" mode="in" longname="系统编号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="GlFile.GlCheckRecord"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstGlaBranchGLbyDate" longname="查询机构日结单数据">
        <sql><![CDATA[select * from gla_branch_gl where trxn_date = #trxn_date# and report_type = #report_type# ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
        </parameterMap>
        <resultMap class="TabGLBasic.gla_branch_gl"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstSubjectData" longname="绩效系统科目供数">
        <sql type="oracle"><![CDATA[
    	select
    	    	gl_code,'' kmkzzz,gl_code_desc,gl_code_level,upper_lvl_gl_code,
    	    	on_bal_sheet_ind 
    	from
    	    	fap_accounting_subject
    	]]></sql>
        <parameterMap class="java.util.HashMap"/>
        <resultMap class="java.util.HashMap"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstGlReportData" longname="绩效系统总账供数">
        <sql type="oracle"><![CDATA[
    	select
    	    	b.trxn_date,a.gl_code,b.branch_id,b.ccy_code,'' subkno,
    	    	b.current_debit_amt,b.current_credit_amt,b.prev_debit_bal, b.prev_credit_bal,b.current_debit_bal,
    	    	b.current_credit_bal,a.acct_bal subj_bal
    	from
    	    	( select
    	    	    	t.gl_code, 'D' as bal_direction, abs(sum(case when t.bal_direction = 'D' then t.acct_bal else t.acct_bal * (-1) end)) as acct_bal 
    	    	from
    	    	    	FAA_ACCOUNT t 
    	    	group by
    	    	    	t.gl_code ) a 
    	LEFT JOIN
    	    	GLA_BRANCH_GL b 
    	    	    	ON a.gl_code = b.gl_code AND b.TRXN_DATE = #trandt#
	where b.report_type = '1' 
    	]]></sql>
        <parameterMap class="java.util.HashMap">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="string" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.util.HashMap"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstGlbGLReportByDate" longname="查询科目总账表">
        <sql><![CDATA[select * from glb_gl_report where trxn_date = #trxn_date# and report_type = #report_type# and gl_date_interval = #gl_date_interval# and 	end_gl_code_ind = #end_gl_code_ind# ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
            <parameter property="gl_date_interval" ref="GlDict.A.gl_date_interval" jdbcType="VARCHAR" javaType="GlBusinessType.E_GLDATEINTERVAL" mode="in" longname="总账区间" parameterType="condition"/>
            <parameter property="end_gl_code_ind" ref="GlDict.A.end_gl_code_ind" jdbcType="VARCHAR" javaType="GlEnumType.E_YESORNO" mode="in" longname="末层科目标志" parameterType="condition"/>
        </parameterMap>
        <resultMap class="TabGLReport.glb_gl_report"/>
    </select>
</sqls>
