<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sqls xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="GlExchange" longname="折币总账命名sql" package="cn.sunline.ltts.busi.gl.namedsql" xsi:noNamespaceSchemaLocation="ltts-model.xsd">
    <delete method="delete" id="delExchangeBook" longname="删除某日折算过程">
        <sql type="oracle"><![CDATA[
    	delete 
    	from
    	    	glb_exchange_process 
    	where
    	    	trxn_date = #trxn_date# and corpno = #org_id# 
    	    	and report_type = #report_type# 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	delete a 
    	from
    	    	glb_exchange_process a 
    	where
    	    	a.trxn_date = #trxn_date# and a.corpno = #org_id# 
    	    	and a.report_type = #report_type# 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	delete 
    	from
    	    	glb_exchange_process 
    	where
    	    	trxn_date = #trxn_date# and corpno = #org_id# 
    	    	and report_type = #report_type# 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
        </parameterMap>
    </delete>
    <delete method="delete" id="delConvertVoch" longname="删除某日折算凭证">
        <sql type="oracle"><![CDATA[
    	delete
    	from
    	    	glb_exchange_voch a 
    	where
    	    	trxn_date = #trxn_date# and corpno = #org_id# 
    	    	and report_type = #report_type# 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	delete a
    	from
    	    	glb_exchange_voch a 
    	where
    	    	trxn_date = #trxn_date# and corpno = #org_id# 
    	    	and report_type = #report_type# 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	delete
    	from
    	    	glb_exchange_voch a 
    	where
    	    	trxn_date = #trxn_date# and corpno = #org_id# 
    	    	and report_type = #report_type# 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
        </parameterMap>
    </delete>
    <insert id="insInitDataProcess" longname="装入折算过程初始数据">
        <sql type="oracle" desc="以上日折币总账为工作底稿 对折算过程做初始化处理"><![CDATA[
    	INSERT 
    	INTO
    	    	glb_exchange_process
    	    	(
    	    	    	corpno, report_type, trxn_date, branch_id, report_branch_id, gl_code, 
    	    	    	exchange_ccy_code, on_bal_sheet_ind, prev_debit_bal, prev_credit_bal,current_debit_amt,
    	    	    	current_credit_amt, current_debit_bal,current_credit_bal, debit_adj_amt, credit_adj_amt, 
    	    	    	debit_adj_err_amt,credit_adj_err_amt ,recdver
    	    	) SELECT
    	    	    	a.corpno, #report_type#, #trxn_date#, a.branch_id, a.branch_id, a.gl_code,
    	    	    	a.exchange_ccy_code, b.on_bal_sheet_ind, a.current_debit_bal, a.current_credit_bal, 0.00,
    	    	    	0.00, 0.00, 0.00, 0.00, 0.00,
    	    	    	0.00, 0.00 ,1
    	    	FROM
    	    	    	gla_exchange_gl a 
    	    	JOIN
    	    	    	fap_accounting_subject b 
    	    	    	    	on a.corpno = b.corpno and a.gl_code = b.gl_code 
    	    	WHERE
    	    	    	a.corpno = #org_id# 
    	    	    	and a.trxn_date = #last_date# and a.branch_id = #branch_id# 
    	    	    	and a.report_type = #report_type# and b.valid_ind = 'Y' 
    	]]></sql>
        <sql type="db2" desc="以上日折币总账为工作底稿 对折算过程做初始化处理"><![CDATA[
    	INSERT 
    	INTO
    	    	glb_exchange_process
    	    	(
    	    	    	corpno, report_type, trxn_date, branch_id, report_branch_id, gl_code, 
    	    	    	exchange_ccy_code, on_bal_sheet_ind, prev_debit_bal, prev_credit_bal,current_debit_amt,
    	    	    	current_credit_amt, current_debit_bal,current_credit_bal, debit_adj_amt, credit_adj_amt, 
    	    	    	debit_adj_err_amt,credit_adj_err_amt ,recdver
    	    	) SELECT
    	    	    	a.corpno, #report_type#, #trxn_date#, a.branch_id, a.branch_id, a.gl_code,
    	    	    	a.exchange_ccy_code, b.on_bal_sheet_ind, a.current_debit_bal, a.current_credit_bal, 0.00,
    	    	    	0.00, 0.00, 0.00, 0.00, 0.00,
    	    	    	0.00, 0.00 ,1
    	    	FROM
    	    	    	gla_exchange_gl a 
    	    	JOIN
    	    	    	fap_accounting_subject b 
    	    	    	    	on a.corpno = b.corpno and a.gl_code = b.gl_code 
    	    	WHERE
    	    	    	a.corpno = #org_id# 
    	    	    	and a.trxn_date = #last_date# and a.branch_id = #branch_id# 
    	    	    	and a.report_type = #report_type# and b.valid_ind = 'Y' 
    	]]></sql>
        <sql type="mysql" desc="以上日折币总账为工作底稿 对折算过程做初始化处理"><![CDATA[
    	INSERT 
    	INTO
    	    	glb_exchange_process
    	    	(
    	    	    	corpno, report_type, trxn_date, branch_id, report_branch_id, gl_code, 
    	    	    	exchange_ccy_code, on_bal_sheet_ind, prev_debit_bal, prev_credit_bal,current_debit_amt,
    	    	    	current_credit_amt, current_debit_bal,current_credit_bal, debit_adj_amt, credit_adj_amt, 
    	    	    	debit_adj_err_amt,credit_adj_err_amt ,recdver
    	    	) SELECT
    	    	    	a.corpno, #report_type#, #trxn_date#, a.branch_id, a.branch_id, a.gl_code,
    	    	    	a.exchange_ccy_code, b.on_bal_sheet_ind, a.current_debit_bal, a.current_credit_bal, 0.00,
    	    	    	0.00, 0.00, 0.00, 0.00, 0.00,
    	    	    	0.00, 0.00 ,1
    	    	FROM
    	    	    	gla_exchange_gl a 
    	    	JOIN
    	    	    	fap_accounting_subject b 
    	    	    	    	on a.corpno = b.corpno and a.gl_code = b.gl_code 
    	    	WHERE
    	    	    	a.corpno = #org_id# 
    	    	    	and a.trxn_date = #last_date# and a.branch_id = #branch_id# 
    	    	    	and a.report_type = #report_type# and b.valid_ind = 'Y' 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="branch_id" ref="GlDict.A.branch_id" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="last_date" ref="GlDict.A.last_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="上日日期" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
        </parameterMap>
    </insert>
    <delete method="delete" id="delDetailBuffer" longname="清空折币明细表">
        <sql type="oracle"><![CDATA[
    	delete 
    	from
    	    	gla_exchange_ledger 
    	where
    	    	corpno = #org_id# and trxn_date = #trxn_date# 
    	    	and branch_id = #branch_id# and report_type = #report_type# 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	delete a 
    	from
    	    	gla_exchange_ledger a 
    	where
    	    	a.corpno = #org_id# and a.trxn_date = #trxn_date# 
    	    	and a.branch_id = #branch_id# and a.report_type = #report_type# 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	delete 
    	from
    	    	gla_exchange_ledger 
    	where
    	    	corpno = #org_id# and trxn_date = #trxn_date# 
    	    	and branch_id = #branch_id# and report_type = #report_type# 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="branch_id" ref="GlDict.A.branch_id" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
        </parameterMap>
    </delete>
    <insert id="insDetailFromGL" longname="由机构总账准备折币数据，表外也参与折算处理，但不参与表内补平">
        <sql type="oracle" desc="适用于货币性项目、以公允价值计量的非货币性项目 "><![CDATA[
    	INSERT 
    	INTO
    	    	gla_exchange_ledger
    	    	(
    	    	    	corpno, report_type, trxn_date, branch_id, ccy_code, exchange_ccy_code, gl_code, 
    	    	    	on_bal_sheet_ind, exchange_rate, exchange_debit_amt, exchange_credit_amt, 
    	    	    	exchange_debit_bal, exchange_credit_bal,recdver
    	    	) SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, a.branch_id, a.ccy_code,
    	    	    	b.exchange_ccy_code, a.gl_code, c.on_bal_sheet_ind, b.exchange_rate, 
    	    	    	round(a.current_debit_amt * b.exchange_rate/b.exchange_rate_unit,2) as exchange_debit_amt, 
    	    	    	round(a.current_credit_amt * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_credit_amt, 
    	    	    	round(a.current_debit_bal * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_debit_bal,
    	    	    	round(a.current_credit_bal * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_credit_bal,1 
    	    	FROM
    	    	    	gla_branch_gl a 
    	    	JOIN
    	    	    	glb_exchange_rate b 
    	    	    	    	ON b.corpno = a.corpno AND b.trxn_date = a.trxn_date 
    	    	    	    	AND b.ccy_code = a.ccy_code 
    	    	JOIN
    	    	    	fap_accounting_subject c 
    	    	    	    	ON c.gl_code = a.gl_code 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND c.valid_ind = 'Y' 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	INSERT 
    	INTO
    	    	gla_exchange_ledger
    	    	(
    	    	    	corpno, report_type, trxn_date, branch_id, ccy_code, exchange_ccy_code, gl_code, 
    	    	    	on_bal_sheet_ind, exchange_rate, exchange_debit_amt, exchange_credit_amt, 
    	    	    	exchange_debit_bal, exchange_credit_bal,recdver
    	    	) SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, a.branch_id, a.ccy_code,
    	    	    	b.exchange_ccy_code, a.gl_code, c.on_bal_sheet_ind, b.exchange_rate, 
    	    	    	round(a.current_debit_amt * b.exchange_rate/b.exchange_rate_unit,2) as exchange_debit_amt, 
    	    	    	round(a.current_credit_amt * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_credit_amt, 
    	    	    	round(a.current_debit_bal * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_debit_bal,
    	    	    	round(a.current_credit_bal * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_credit_bal,1 
    	    	FROM
    	    	    	gla_branch_gl a 
    	    	JOIN
    	    	    	glb_exchange_rate b 
    	    	    	    	ON b.corpno = a.corpno AND b.trxn_date = a.trxn_date 
    	    	    	    	AND b.ccy_code = a.ccy_code 
    	    	JOIN
    	    	    	fap_accounting_subject c 
    	    	    	    	ON c.gl_code = a.gl_code 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND c.valid_ind = 'Y' 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	INSERT 
    	INTO
    	    	gla_exchange_ledger
    	    	(
    	    	    	corpno, report_type, trxn_date, branch_id, ccy_code, exchange_ccy_code, gl_code, 
    	    	    	on_bal_sheet_ind, exchange_rate, exchange_debit_amt, exchange_credit_amt, 
    	    	    	exchange_debit_bal, exchange_credit_bal,recdver
    	    	) SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, a.branch_id, a.ccy_code,
    	    	    	b.exchange_ccy_code, a.gl_code, c.on_bal_sheet_ind, b.exchange_rate, 
    	    	    	round(a.current_debit_amt * b.exchange_rate/b.exchange_rate_unit,2) as exchange_debit_amt, 
    	    	    	round(a.current_credit_amt * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_credit_amt, 
    	    	    	round(a.current_debit_bal * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_debit_bal,
    	    	    	round(a.current_credit_bal * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_credit_bal,1 
    	    	FROM
    	    	    	gla_branch_gl a 
    	    	JOIN
    	    	    	glb_exchange_rate b 
    	    	    	    	ON b.corpno = a.corpno AND b.trxn_date = a.trxn_date 
    	    	    	    	AND b.ccy_code = a.ccy_code 
    	    	JOIN
    	    	    	fap_accounting_subject c 
    	    	    	    	ON c.gl_code = a.gl_code 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND c.valid_ind = 'Y' 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="branch_id" ref="GlDict.A.branch_id" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
        </parameterMap>
    </insert>
    <insert id="insDetailFromGL2" longname="由机构总账准备折币数据，表外也参与折算处理，但不参与表内补平,折算汇率找最近日期">
        <sql type="oracle" desc="适用于货币性项目、以公允价值计量的非货币性项目 "><![CDATA[
    	INSERT 
    	INTO
    	    	gla_exchange_ledger
    	    	(
    	    	    	corpno, report_type, trxn_date, branch_id, ccy_code, exchange_ccy_code, gl_code, on_bal_sheet_ind, exchange_rate, exchange_debit_amt, exchange_credit_amt, exchange_debit_bal, exchange_credit_bal, recdver
    	    	) SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, a.branch_id, a.ccy_code,
    	    	    	b.exchange_ccy_code, a.gl_code, c.on_bal_sheet_ind, b.exchange_rate, round(a.current_debit_amt * b.exchange_rate/b.exchange_rate_unit,
    	    	    	2) as exchange_debit_amt, round(a.current_credit_amt * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_credit_amt, round(a.current_debit_bal * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_debit_bal,
    	    	    	round(a.current_credit_bal * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_credit_bal ,1
    	    	FROM
    	    	    	gla_branch_gl a 
    	    	JOIN
    	    	    	glb_exchange_rate b 
    	    	    	    	ON b.corpno = a.corpno 
    	    	    	    	AND b.ccy_code = a.ccy_code 
    	    	JOIN
    	    	    	fap_accounting_subject c 
    	    	    	    	ON c.gl_code = a.gl_code 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND c.valid_ind = 'Y' and b.trxn_date = (
    	    	    	    	select
    	    	    	    	    	max(trxn_date) 
    	    	    	    	from
    	    	    	    	    	glb_exchange_rate d 
    	    	    	    	where
    	    	    	    	    	d.ccy_code=b.ccy_code 
    	    	    	    	    	and d.exchange_ccy_code=b.exchange_ccy_code and d.corpno = b.corpno 
    	    	    	) 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	INSERT 
    	INTO
    	    	gla_exchange_ledger
    	    	(
    	    	    	corpno, report_type, trxn_date, branch_id, ccy_code, exchange_ccy_code, gl_code, on_bal_sheet_ind, exchange_rate, exchange_debit_amt, exchange_credit_amt, exchange_debit_bal, exchange_credit_bal, recdver
    	    	) SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, a.branch_id, a.ccy_code,
    	    	    	b.exchange_ccy_code, a.gl_code, c.on_bal_sheet_ind, b.exchange_rate, round(a.current_debit_amt * b.exchange_rate/b.exchange_rate_unit,
    	    	    	2) as exchange_debit_amt, round(a.current_credit_amt * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_credit_amt, round(a.current_debit_bal * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_debit_bal,
    	    	    	round(a.current_credit_bal * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_credit_bal ,1
    	    	FROM
    	    	    	gla_branch_gl a 
    	    	JOIN
    	    	    	glb_exchange_rate b 
    	    	    	    	ON b.corpno = a.corpno 
    	    	    	    	AND b.ccy_code = a.ccy_code 
    	    	JOIN
    	    	    	fap_accounting_subject c 
    	    	    	    	ON c.gl_code = a.gl_code 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND c.valid_ind = 'Y' and b.trxn_date = (
    	    	    	    	select
    	    	    	    	    	max(trxn_date) 
    	    	    	    	from
    	    	    	    	    	glb_exchange_rate d 
    	    	    	    	where
    	    	    	    	    	d.ccy_code=b.ccy_code 
    	    	    	    	    	and d.exchange_ccy_code=b.exchange_ccy_code and d.corpno = b.corpno 
    	    	    	) 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	INSERT 
    	INTO
    	    	gla_exchange_ledger
    	    	(
    	    	    	corpno, report_type, trxn_date, branch_id, ccy_code, exchange_ccy_code, gl_code, on_bal_sheet_ind, exchange_rate, exchange_debit_amt, exchange_credit_amt, exchange_debit_bal, exchange_credit_bal, recdver
    	    	) SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, a.branch_id, a.ccy_code,
    	    	    	b.exchange_ccy_code, a.gl_code, c.on_bal_sheet_ind, b.exchange_rate, round(a.current_debit_amt * b.exchange_rate/b.exchange_rate_unit,
    	    	    	2) as exchange_debit_amt, round(a.current_credit_amt * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_credit_amt, round(a.current_debit_bal * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_debit_bal,
    	    	    	round(a.current_credit_bal * b.exchange_rate/b.exchange_rate_unit, 2) as exchange_credit_bal ,1
    	    	FROM
    	    	    	gla_branch_gl a 
    	    	JOIN
    	    	    	glb_exchange_rate b 
    	    	    	    	ON b.corpno = a.corpno 
    	    	    	    	AND b.ccy_code = a.ccy_code 
    	    	JOIN
    	    	    	fap_accounting_subject c 
    	    	    	    	ON c.gl_code = a.gl_code 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND c.valid_ind = 'Y' and b.trxn_date = (
    	    	    	    	select
    	    	    	    	    	max(trxn_date) 
    	    	    	    	from
    	    	    	    	    	glb_exchange_rate d 
    	    	    	    	where
    	    	    	    	    	d.ccy_code=b.ccy_code 
    	    	    	    	    	and d.exchange_ccy_code=b.exchange_ccy_code and d.corpno = b.corpno 
    	    	    	) 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="branch_id" ref="GlDict.A.branch_id" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectAll" type="sql" id="lstExchangeData" longname="获取折币数据">
        <sql type="oracle" desc="数据来源于机构总账"><![CDATA[
    	SELECT
    	    	gl_code, exchange_ccy_code, on_bal_sheet_ind, sum(exchange_debit_amt) as exchange_debit_amt, sum(exchange_credit_amt) as exchange_credit_amt,
    	    	sum(exchange_debit_bal) as exchange_debit_bal, sum(exchange_credit_bal) as exchange_credit_bal 
    	FROM
    	    	gla_exchange_ledger a 
    	WHERE
    	    	corpno = #org_id# AND trxn_date = #trxn_date# 
    	    	AND branch_id = #branch_id# AND report_type = #report_type# 
    	GROUP BY
    	    	gl_code, exchange_ccy_code, on_bal_sheet_ind 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	SELECT
    	    	gl_code, exchange_ccy_code, on_bal_sheet_ind, sum(exchange_debit_amt) as exchange_debit_amt, sum(exchange_credit_amt) as exchange_credit_amt,
    	    	sum(exchange_debit_bal) as exchange_debit_bal, sum(exchange_credit_bal) as exchange_credit_bal 
    	FROM
    	    	gla_exchange_ledger a 
    	WHERE
    	    	corpno = #org_id# AND trxn_date = #trxn_date# 
    	    	AND branch_id = #branch_id# AND report_type = #report_type# 
    	GROUP BY
    	    	gl_code, exchange_ccy_code, on_bal_sheet_ind 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	SELECT
    	    	gl_code, exchange_ccy_code, on_bal_sheet_ind, sum(exchange_debit_amt) as exchange_debit_amt, sum(exchange_credit_amt) as exchange_credit_amt,
    	    	sum(exchange_debit_bal) as exchange_debit_bal, sum(exchange_credit_bal) as exchange_credit_bal 
    	FROM
    	    	gla_exchange_ledger a 
    	WHERE
    	    	corpno = #org_id# AND trxn_date = #trxn_date# 
    	    	AND branch_id = #branch_id# AND report_type = #report_type# 
    	GROUP BY
    	    	gl_code, exchange_ccy_code, on_bal_sheet_ind 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="branch_id" ref="GlDict.A.branch_id" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
        </parameterMap>
        <resultMap class="GlExchange.GlExchangeGL"/>
    </select>
    <insert id="insExchangeVoch" longname="将折合过程登记到折币种传票表">
        <sql type="oracle"><![CDATA[
    	INSERT 
    	INTO
    	    	glb_exchange_voch
    	    	(
    	    	    	corpno, report_type, trxn_date, reg_no, exchange_ccy_code, 
    	    	    	branch_id, gl_code, debit_credit, accounting_amt, remark, on_bal_sheet_ind, recdver
    	    	) SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 11, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'D', a.current_debit_amt, 'current term rate exchange' ,
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND a.current_debit_amt <> 0.00 
    	    	UNION
    	    	ALL SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 12, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'C', a.current_credit_amt, 'current term rate exchange',
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND a.current_credit_amt <> 0.00 
    	    	UNION
    	    	ALL SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 15, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'D', a.debit_adj_amt, 'rate profit and loss',
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND a.debit_adj_amt <> 0.00 
    	    	UNION
    	    	ALL SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 16, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'C', a.credit_adj_amt, 'rate profit and loss',
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND a.credit_adj_amt <> 0.00 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	INSERT 
    	INTO
    	    	glb_exchange_voch
    	    	(
    	    	    	corpno, report_type, trxn_date, reg_no, exchange_ccy_code, 
    	    	    	branch_id, gl_code, debit_credit, accounting_amt, remark, on_bal_sheet_ind, recdver
    	    	) SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 11, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'D', a.current_debit_amt, 'current term rate exchange' ,
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND a.current_debit_amt <> 0.00 
    	    	UNION
    	    	ALL SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 12, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'C', a.current_credit_amt, 'current term rate exchange',
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND a.current_credit_amt <> 0.00 
    	    	UNION
    	    	ALL SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 15, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'D', a.debit_adj_amt, 'rate profit and loss',
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND a.debit_adj_amt <> 0.00 
    	    	UNION
    	    	ALL SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 16, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'C', a.credit_adj_amt, 'rate profit and loss',
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND a.credit_adj_amt <> 0.00 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	INSERT 
    	INTO
    	    	glb_exchange_voch
    	    	(
    	    	    	corpno, report_type, trxn_date, reg_no, exchange_ccy_code, 
    	    	    	branch_id, gl_code, debit_credit, accounting_amt, remark, on_bal_sheet_ind, recdver
    	    	) SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 11, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'D', a.current_debit_amt, 'current term rate exchange' ,
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND a.current_debit_amt <> 0.00 
    	    	UNION
    	    	ALL SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 12, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'C', a.current_credit_amt, 'current term rate exchange',
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND a.current_credit_amt <> 0.00 
    	    	UNION
    	    	ALL SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 15, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'D', a.debit_adj_amt, 'rate profit and loss',
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND a.debit_adj_amt <> 0.00 
    	    	UNION
    	    	ALL SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 16, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'C', a.credit_adj_amt, 'rate profit and loss',
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.branch_id = #branch_id# AND a.report_type = #report_type# 
    	    	    	AND a.credit_adj_amt <> 0.00 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="branch_id" ref="GlDict.A.branch_id" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectOne" type="sql" id="selFillAmount" longname="获取平补金额">
        <sql type="oracle" desc="以机构为单位，计算平补金额"><![CDATA[
    	SELECT
    	    	nvl(sum(a.current_debit_amt + a.debit_adj_amt - a.current_credit_amt - a.credit_adj_amt), 0.00) as debit_adj_err_amt 
    	FROM
    	    	glb_exchange_process a 
    	WHERE
    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	AND a.exchange_ccy_code = #exchange_ccy_code# AND a.branch_id = #branch_id# 
    	    	AND a.report_type = #report_type# AND a.on_bal_sheet_ind = 'Y' 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	SELECT
    	    	IFNULL(sum(a.current_debit_amt + a.debit_adj_amt - a.current_credit_amt - a.credit_adj_amt), 0.00) as debit_adj_err_amt 
    	FROM
    	    	glb_exchange_process a 
    	WHERE
    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	AND a.exchange_ccy_code = #exchange_ccy_code# AND a.branch_id = #branch_id# 
    	    	AND a.report_type = #report_type# AND a.on_bal_sheet_ind = 'Y' 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	SELECT
    	    	value(sum(a.current_debit_amt + a.debit_adj_amt - a.current_credit_amt - a.credit_adj_amt), 0.00) as debit_adj_err_amt 
    	FROM
    	    	glb_exchange_process a 
    	WHERE
    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	AND a.exchange_ccy_code = #exchange_ccy_code# AND a.branch_id = #branch_id# 
    	    	AND a.report_type = #report_type# AND a.on_bal_sheet_ind = 'Y' 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="exchange_ccy_code" ref="GlDict.A.exchange_ccy_code" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="折合币种" parameterType="condition"/>
            <parameter property="branch_id" ref="GlDict.A.branch_id" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.math.BigDecimal"/>
    </select>
    <insert id="insExchangeVochByFill" longname="将平补数据登记到折币种传票表">
        <sql type="oracle"><![CDATA[
    	INSERT 
    	INTO
    	    	glb_exchange_voch
    	    	(
    	    	    	corpno, report_type, trxn_date, reg_no, exchange_ccy_code, 
    	    	    	branch_id, gl_code, debit_credit, accounting_amt, remark, on_bal_sheet_ind,recdver 
    	    	) SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 17, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'D', a.debit_adj_err_amt, 'rounding rate exchange' ,
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.exchange_ccy_code = #exchange_ccy_code# AND a.report_type = #report_type# 
    	    	    	AND a.debit_adj_err_amt <> 0.00 
    	    	UNION
    	    	ALL SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 18, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'C', a.credit_adj_err_amt, 'rounding rate exchange',
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.exchange_ccy_code = #exchange_ccy_code# AND a.report_type = #report_type# 
    	    	    	AND a.credit_adj_err_amt <> 0.00 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	INSERT 
    	INTO
    	    	glb_exchange_voch
    	    	(
    	    	    	corpno, report_type, trxn_date, reg_no, exchange_ccy_code, 
    	    	    	branch_id, gl_code, debit_credit, accounting_amt, remark, on_bal_sheet_ind,recdver 
    	    	) SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 17, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'D', a.debit_adj_err_amt, 'rounding rate exchange' ,
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.exchange_ccy_code = #exchange_ccy_code# AND a.report_type = #report_type# 
    	    	    	AND a.debit_adj_err_amt <> 0.00 
    	    	UNION
    	    	ALL SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 18, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'C', a.credit_adj_err_amt, 'rounding rate exchange',
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.exchange_ccy_code = #exchange_ccy_code# AND a.report_type = #report_type# 
    	    	    	AND a.credit_adj_err_amt <> 0.00 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	INSERT 
    	INTO
    	    	glb_exchange_voch
    	    	(
    	    	    	corpno, report_type, trxn_date, reg_no, exchange_ccy_code, 
    	    	    	branch_id, gl_code, debit_credit, accounting_amt, remark, on_bal_sheet_ind,recdver 
    	    	) SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 17, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'D', a.debit_adj_err_amt, 'rounding rate exchange' ,
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.exchange_ccy_code = #exchange_ccy_code# AND a.report_type = #report_type# 
    	    	    	AND a.debit_adj_err_amt <> 0.00 
    	    	UNION
    	    	ALL SELECT
    	    	    	a.corpno, a.report_type, a.trxn_date, 18, a.exchange_ccy_code,
    	    	    	a.branch_id, a.gl_code, 'C', a.credit_adj_err_amt, 'rounding rate exchange',
    	    	    	a.on_bal_sheet_ind ,1
    	    	from
    	    	    	glb_exchange_process a 
    	    	WHERE
    	    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	    	AND a.exchange_ccy_code = #exchange_ccy_code# AND a.report_type = #report_type# 
    	    	    	AND a.credit_adj_err_amt <> 0.00 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
            <parameter property="exchange_ccy_code" ref="GlDict.A.exchange_ccy_code" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="折合币种" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectAll" type="sql" id="lstVoucherNotBalList" longname="查询不平衡的凭证数据">
        <sql type="oracle"><![CDATA[
    	SELECT
    	    	a.exchange_ccy_code as ccy_code, 
    	    	sum(case when a.debit_credit = 'D' then a.accounting_amt else 0.00 end ) as debit_amt, 
    	    	sum(case when a.debit_credit = 'C' then a.accounting_amt else 0.00 end ) as credit_amt, 
    	    	sum(case when a.debit_credit = 'D' then a.accounting_amt else 0 - a.accounting_amt end ) as accounting_amt 
    	FROM
    	    	glb_exchange_voch a 
    	WHERE
    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	AND a.report_type = #report_type# And a.on_bal_sheet_ind = 'Y' 
    	GROUP BY
    	    	a.exchange_ccy_code 
    	HAVING
    	    	sum(case when a.debit_credit = 'D' then a.accounting_amt else 0 - a.accounting_amt end ) <> 0.00 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	SELECT
    	    	a.exchange_ccy_code as ccy_code, 
    	    	sum(case when a.debit_credit = 'D' then a.accounting_amt else 0.00 end ) as debit_amt, 
    	    	sum(case when a.debit_credit = 'C' then a.accounting_amt else 0.00 end ) as credit_amt, 
    	    	sum(case when a.debit_credit = 'D' then a.accounting_amt else 0 - a.accounting_amt end ) as accounting_amt 
    	FROM
    	    	glb_exchange_voch a 
    	WHERE
    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	AND a.report_type = #report_type# And a.on_bal_sheet_ind = 'Y' 
    	GROUP BY
    	    	a.exchange_ccy_code 
    	HAVING
    	    	sum(case when a.debit_credit = 'D' then a.accounting_amt else 0 - a.accounting_amt end ) <> 0.00 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	SELECT
    	    	a.exchange_ccy_code as ccy_code, 
    	    	sum(case when a.debit_credit = 'D' then a.accounting_amt else 0.00 end ) as debit_amt, 
    	    	sum(case when a.debit_credit = 'C' then a.accounting_amt else 0.00 end ) as credit_amt, 
    	    	sum(case when a.debit_credit = 'D' then a.accounting_amt else 0 - a.accounting_amt end ) as accounting_amt 
    	FROM
    	    	glb_exchange_voch a 
    	WHERE
    	    	a.corpno = #org_id# AND a.trxn_date = #trxn_date# 
    	    	AND a.report_type = #report_type# And a.on_bal_sheet_ind = 'Y' 
    	GROUP BY
    	    	a.exchange_ccy_code 
    	HAVING
    	    	sum(case when a.debit_credit = 'D' then a.accounting_amt else 0 - a.accounting_amt end ) <> 0.00 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
        </parameterMap>
        <resultMap class="GlBranch.GlVochBalData"/>
    </select>
    <delete method="delete" id="delExchangeGL" longname="删除某日折币总账">
        <sql type="oracle"><![CDATA[
    	delete 
    	from
    	    	gla_exchange_gl 
    	where
    	    	trxn_date = #trxn_date# and corpno = #org_id# 
    	    	and report_type = #report_type# 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	delete a 
    	from
    	    	gla_exchange_gl a 
    	where
    	    	a.trxn_date = #trxn_date# and a.corpno = #org_id# 
    	    	and a.report_type = #report_type# 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	delete 
    	from
    	    	gla_exchange_gl 
    	where
    	    	trxn_date = #trxn_date# and corpno = #org_id# 
    	    	and report_type = #report_type# 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
        </parameterMap>
    </delete>
    <insert id="insInitDataGl" longname="装入折币总账初始数据">
        <sql type="oracle" desc="从上日折币总账装入初始数据"><![CDATA[
    	insert 
    	into
    	    	gla_exchange_gl
    	    	( corpno, report_type, trxn_date, branch_id, exchange_ccy_code, gl_code, 
    	    		prev_debit_bal, prev_credit_bal, current_debit_amt, 
    	    		current_credit_amt, current_debit_bal,current_credit_bal,recdver ) 
    	    	select
    	    	    	a.corpno, a.report_type, #trxn_date#, a.branch_id, a.exchange_ccy_code, a.gl_code, 
    	    	    	a.current_debit_bal, a.current_credit_bal, 0.00, 
    	    	    	0.00, a.current_debit_bal, a.current_credit_bal ,1
    	    	from
    	    	    	gla_exchange_gl a 
    	    	where
    	    	    	a.trxn_date = #last_date# and a.corpno = #org_id# 
    	    	    	and a.branch_id = #branch_id# and a.report_type = #report_type# 
    	    	    	and a.current_debit_bal <> a.current_credit_bal 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	insert 
    	into
    	    	gla_exchange_gl
    	    	( corpno, report_type, trxn_date, branch_id, exchange_ccy_code, gl_code, 
    	    		prev_debit_bal, prev_credit_bal, current_debit_amt, 
    	    		current_credit_amt, current_debit_bal,current_credit_bal,recdver ) 
    	    	select
    	    	    	a.corpno, a.report_type, #trxn_date#, a.branch_id, a.exchange_ccy_code, a.gl_code, 
    	    	    	a.current_debit_bal, a.current_credit_bal, 0.00, 
    	    	    	0.00, a.current_debit_bal, a.current_credit_bal ,1
    	    	from
    	    	    	gla_exchange_gl a 
    	    	where
    	    	    	a.trxn_date = #last_date# and a.corpno = #org_id# 
    	    	    	and a.branch_id = #branch_id# and a.report_type = #report_type# 
    	    	    	and a.current_debit_bal <> a.current_credit_bal 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	insert 
    	into
    	    	gla_exchange_gl
    	    	( corpno, report_type, trxn_date, branch_id, exchange_ccy_code, gl_code, 
    	    		prev_debit_bal, prev_credit_bal, current_debit_amt, 
    	    		current_credit_amt, current_debit_bal,current_credit_bal,recdver ) 
    	    	select
    	    	    	a.corpno, a.report_type, #trxn_date#, a.branch_id, a.exchange_ccy_code, a.gl_code, 
    	    	    	a.current_debit_bal, a.current_credit_bal, 0.00, 
    	    	    	0.00, a.current_debit_bal, a.current_credit_bal ,1
    	    	from
    	    	    	gla_exchange_gl a 
    	    	where
    	    	    	a.trxn_date = #last_date# and a.corpno = #org_id# 
    	    	    	and a.branch_id = #branch_id# and a.report_type = #report_type# 
    	    	    	and a.current_debit_bal <> a.current_credit_bal 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="branch_id" ref="GlDict.A.branch_id" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="last_date" ref="GlDict.A.last_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="上日日期" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectAll" type="sql" id="lstGlTranData" longname="查询折算总账发生数据">
        <sql type="oracle"><![CDATA[
    	select
    	    	a.exchange_ccy_code as ccy_code, a.gl_code, 
    	    	sum(case when a.debit_credit = 'D' then a.accounting_amt else 0.00 end ) as debit_amt, 
    	    	sum(case when a.debit_credit = 'C' then a.accounting_amt else 0.00 end ) as credit_amt 
    	from
    	    	glb_exchange_voch a 
    	where
    	    	a.trxn_date = #trxn_date# and a.corpno = #org_id# 
    	    	and a.branch_id = #branch_id# and a.report_type = #report_type# 
    	group by
    	    	a.exchange_ccy_code, a.gl_code 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	select
    	    	a.exchange_ccy_code as ccy_code, a.gl_code, 
    	    	sum(case when a.debit_credit = 'D' then a.accounting_amt else 0.00 end ) as debit_amt, 
    	    	sum(case when a.debit_credit = 'C' then a.accounting_amt else 0.00 end ) as credit_amt 
    	from
    	    	glb_exchange_voch a 
    	where
    	    	a.trxn_date = #trxn_date# and a.corpno = #org_id# 
    	    	and a.branch_id = #branch_id# and a.report_type = #report_type# 
    	group by
    	    	a.exchange_ccy_code, a.gl_code 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	a.exchange_ccy_code as ccy_code, a.gl_code, 
    	    	sum(case when a.debit_credit = 'D' then a.accounting_amt else 0.00 end ) as debit_amt, 
    	    	sum(case when a.debit_credit = 'C' then a.accounting_amt else 0.00 end ) as credit_amt 
    	from
    	    	glb_exchange_voch a 
    	where
    	    	a.trxn_date = #trxn_date# and a.corpno = #org_id# 
    	    	and a.branch_id = #branch_id# and a.report_type = #report_type# 
    	group by
    	    	a.exchange_ccy_code, a.gl_code 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="branch_id" ref="GlDict.A.branch_id" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
        </parameterMap>
        <resultMap class="GlBranch.GlTranData"/>
    </select>
    <select cache="trans" method="selectPage" type="sql" id="lstErrorBalData" longname="获取某个机构不平衡的总账数据">
        <sql type="oracle" desc="指期初 + 发生 不等于 期末"><![CDATA[
        select  trxn_date, branch_id, exchange_ccy_code as ccy_code, gl_code,
               prev_debit_bal, prev_credit_bal, current_debit_amt, current_credit_amt, current_debit_bal,current_credit_bal
            from gla_exchange_gl a
           where a.corpno = #org_id#
             and a.report_type = #report_type#
             and a.trxn_date = #trxn_date#
             and a.branch_id = #branch_id#
             and a.prev_debit_bal - a.prev_credit_bal + a.current_debit_amt - a.current_credit_amt <> a.current_debit_bal - a.current_credit_bal
        ]]></sql>
        <sql type="db2"><![CDATA[
        select  trxn_date, branch_id, exchange_ccy_code as ccy_code, gl_code,
               prev_debit_bal, prev_credit_bal, current_debit_amt, current_credit_amt, current_debit_bal,current_credit_bal
            from gla_exchange_gl a
           where a.corpno = #org_id#
             and a.report_type = #report_type#
             and a.trxn_date = #trxn_date#
             and a.branch_id = #branch_id#
             and a.prev_debit_bal - a.prev_credit_bal + a.current_debit_amt - a.current_credit_amt <> a.current_debit_bal - a.current_credit_bal
        ]]></sql>
        <sql type="mysql"><![CDATA[
        select  trxn_date, branch_id, exchange_ccy_code as ccy_code, gl_code,
               prev_debit_bal, prev_credit_bal, current_debit_amt, current_credit_amt, current_debit_bal,current_credit_bal
            from gla_exchange_gl a
           where a.corpno = #org_id#
             and a.report_type = #report_type#
             and a.trxn_date = #trxn_date#
             and a.branch_id = #branch_id#
             and a.prev_debit_bal - a.prev_credit_bal + a.current_debit_amt - a.current_credit_amt <> a.current_debit_bal - a.current_credit_bal
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="branch_id" ref="GlDict.A.branch_id" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="GlBranch.GlItemGL"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstYearEndIncome" longname="获取折币总账某机构损益未清零数据（折算年终损益结转后）">
        <sql type="oracle" desc="指期末余额不为零的折币损益科目数据"><![CDATA[
    	select
    	    	trxn_date, branch_id, exchange_ccy_code as ccy_code , gl_code, prev_debit_bal,
    	    	prev_credit_bal, current_debit_amt, current_credit_amt, current_debit_bal,current_credit_bal 
    	from
    	    	gla_exchange_gl a 
    	where
    	    	a.corpno = #org_id# and a.report_type = #report_type# 
    	    	and a.trxn_date = #trxn_date# and a.branch_id = #branch_id# 
    	    	and exists (
    	    	    	select
    	    	    	    	1 
    	    	    	from
    	    	    	    	fap_accounting_subject b 
    	    	    	where
    	    	    	    	a.corpno=b.corpno and a.gl_code = b.gl_code 
    	    	    	    	and b.gl_code_type = '6' 
    	    	) and (
    	    	    	a.current_debit_bal <> 0 or a.current_credit_bal <> 0 
    	    	) 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	select
    	    	trxn_date, branch_id, exchange_ccy_code as ccy_code , gl_code, prev_debit_bal,
    	    	prev_credit_bal, current_debit_amt, current_credit_amt, current_debit_bal,current_credit_bal 
    	from
    	    	gla_exchange_gl a 
    	where
    	    	a.corpno = #org_id# and a.report_type = #report_type# 
    	    	and a.trxn_date = #trxn_date# and a.branch_id = #branch_id# 
    	    	and exists (
    	    	    	select
    	    	    	    	1 
    	    	    	from
    	    	    	    	fap_accounting_subject b 
    	    	    	where
    	    	    	    	a.corpno=b.corpno and a.gl_code = b.gl_code 
    	    	    	    	and b.gl_code_type = '6' 
    	    	) and (
    	    	    	a.current_debit_bal <> 0 or a.current_credit_bal <> 0 
    	    	) 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	trxn_date, branch_id, exchange_ccy_code as ccy_code , gl_code, prev_debit_bal,
    	    	prev_credit_bal, current_debit_amt, current_credit_amt, current_debit_bal,current_credit_bal 
    	from
    	    	gla_exchange_gl a 
    	where
    	    	a.corpno = #org_id# and a.report_type = #report_type# 
    	    	and a.trxn_date = #trxn_date# and a.branch_id = #branch_id# 
    	    	and exists (
    	    	    	select
    	    	    	    	1 
    	    	    	from
    	    	    	    	fap_accounting_subject b 
    	    	    	where
    	    	    	    	a.corpno=b.corpno and a.gl_code = b.gl_code 
    	    	    	    	and b.gl_code_type = '6' 
    	    	) and (
    	    	    	a.current_debit_bal <> 0 or a.current_credit_bal <> 0 
    	    	) 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="branch_id" ref="GlDict.A.branch_id" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="GlBranch.GlItemGL"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstYearEndProfit" longname="获取折币总账某机构本年利润数据（折算年终损益结转后）">
        <sql type="oracle" desc="指期末余额不为零的折币损益科目数据"><![CDATA[
    	select
    	    	trxn_date, branch_id, exchange_ccy_code as ccy_code , gl_code, prev_debit_bal,
    	    	prev_credit_bal, current_debit_amt, current_credit_amt, current_debit_bal,current_credit_bal 
    	from
    	    	gla_exchange_gl a 
    	where
    	    	a.corpno = #org_id# and a.report_type = #report_type# 
    	    	and a.trxn_date = #trxn_date# and a.branch_id = #branch_id# 
    	    	and a.gl_code = #gl_code# and (
    	    	    	a.current_debit_bal <> 0 or a.current_credit_bal <> 0 
    	    	) 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	select
    	    	trxn_date, branch_id, exchange_ccy_code as ccy_code , gl_code, prev_debit_bal,
    	    	prev_credit_bal, current_debit_amt, current_credit_amt, current_debit_bal,current_credit_bal 
    	from
    	    	gla_exchange_gl a 
    	where
    	    	a.corpno = #org_id# and a.report_type = #report_type# 
    	    	and a.trxn_date = #trxn_date# and a.branch_id = #branch_id# 
    	    	and a.gl_code = #gl_code# and (
    	    	    	a.current_debit_bal <> 0 or a.current_credit_bal <> 0 
    	    	) 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	trxn_date, branch_id, exchange_ccy_code as ccy_code , gl_code, prev_debit_bal,
    	    	prev_credit_bal, current_debit_amt, current_credit_amt, current_debit_bal,current_credit_bal 
    	from
    	    	gla_exchange_gl a 
    	where
    	    	a.corpno = #org_id# and a.report_type = #report_type# 
    	    	and a.trxn_date = #trxn_date# and a.branch_id = #branch_id# 
    	    	and a.gl_code = #gl_code# and (
    	    	    	a.current_debit_bal <> 0 or a.current_credit_bal <> 0 
    	    	) 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="branch_id" ref="GlDict.A.branch_id" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="gl_code" ref="GlDict.A.gl_code" jdbcType="VARCHAR" javaType="GlBaseType.U_SUBJECTNO" mode="in" longname="科目号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="GlBranch.GlItemGL"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="cntExchangeCurrencyCode" longname="获取当日指定折算币种的数据">
        <sql type="oracle"><![CDATA[
    	SELECT
    	    	count(*) 
    	FROM
    	    	glb_exchange_rate a 
    	WHERE
    	    	corpno = #org_id# AND trxn_date = #trxn_date# 
    	    	and exchange_ccy_code=#exchange_ccy_code# 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	SELECT
    	    	count(*) 
    	FROM
    	    	glb_exchange_rate a 
    	WHERE
    	    	corpno = #org_id# AND trxn_date = #trxn_date# 
    	    	and exchange_ccy_code=#exchange_ccy_code# 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	SELECT
    	    	count(*) 
    	FROM
    	    	glb_exchange_rate a 
    	WHERE
    	    	corpno = #org_id# AND trxn_date = #trxn_date# 
    	    	and exchange_ccy_code=#exchange_ccy_code# 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="exchange_ccy_code" ref="GlDict.A.exchange_ccy_code" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="折合币种" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="cntAllExchangeCcy" longname="获取是否有折算币种汇率">
        <sql type="oracle"><![CDATA[
    	SELECT
    	    	count(*) 
    	FROM
    	    	glb_exchange_rate 
    	WHERE
    	    	corpno = #org_id# AND exchange_ccy_code=#exchange_ccy_code# 
    	    	and trxn_date <= #trxn_date# 
    	]]></sql>
        <sql type="db2"><![CDATA[
    	SELECT
    	    	count(*) 
    	FROM
    	    	glb_exchange_rate 
    	WHERE
    	    	corpno = #org_id# AND exchange_ccy_code=#exchange_ccy_code# 
    	    	and trxn_date <= #trxn_date# 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	SELECT
    	    	count(*) 
    	FROM
    	    	glb_exchange_rate 
    	WHERE
    	    	corpno = #org_id# AND exchange_ccy_code=#exchange_ccy_code# 
    	    	and trxn_date <= #trxn_date# 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="exchange_ccy_code" ref="GlDict.A.exchange_ccy_code" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="折合币种" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selExchangeVochMaxRegNo" longname="获取指定条件最大登记号">
        <sql type="mysql"><![CDATA[
    	SELECT
    	    	case when ifnull(max(reg_no),20)+1 < 21 then 23 else ifnull(max(reg_no),20)+1 end 
    	FROM
    	    	glb_exchange_voch a 
    	WHERE
    	    	corpno = #org_id# AND report_type = #report_type# 
    	    	AND trxn_date = #trxn_date# and gl_code=#gl_code# 
    	]]></sql>
        <sql type="oracle"><![CDATA[
    	SELECT
    	    	case when nvl(max(reg_no),20)+1 < 21 then 23 else nvl(max(reg_no),20)+1 end
    	FROM
    	    	glb_exchange_voch a 
    	WHERE
    	    	corpno = #org_id# AND report_type = #report_type# AND trxn_date = #trxn_date# 
    	    	and gl_code=#gl_code#
    	]]></sql>
        <sql type="db2"><![CDATA[
    	SELECT
    	    	case when value(max(reg_no),20)+1 < 21 then 23 else nvl(max(reg_no),20)+1 end
    	FROM
    	    	glb_exchange_voch a 
    	WHERE
    	    	corpno = #org_id# AND report_type = #report_type# AND trxn_date = #trxn_date# 
    	    	and gl_code=#gl_code#
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="report_type" ref="GlDict.A.report_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_REPORTTYPE" mode="in" longname="报表类型" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="gl_code" ref="GlDict.A.gl_code" jdbcType="VARCHAR" javaType="GlBaseType.U_SUBJECTNO" mode="in" longname="科目号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <dynamicSelect cache="none" method="selectPageWithCount" type="sql" id="lstExchangeRateInfo" longname="折算汇率信息查询">
        <parameterMap class="java.util.Map">
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="ccy_code" ref="GlDict.A.ccy_code" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="货币代码" parameterType="condition"/>
            <parameter property="exchange_ccy_code" ref="GlDict.A.exchange_ccy_code" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="折合币种" parameterType="condition"/>
            <parameter property="exchange_rate_unit" ref="GlDict.A.exchange_rate_unit" jdbcType="VARCHAR" javaType="GlBaseType.U_LONG" mode="in" longname="折算单位" parameterType="condition"/>
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="GlExchange.GlExchangeRateInfo"/>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[select * from glb_exchange_rate]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[corpno = #org_id#]]></str>
                    <if test="trxn_date!=null &amp;&amp; trxn_date!=''" type="If">
                        <str type="Str"><![CDATA[trxn_date=#trxn_date#]]></str>
                    </if>
                    <if test="ccy_code!=null &amp;&amp; ccy_code!=''" type="If">
                        <str type="Str"><![CDATA[ccy_code=#ccy_code#]]></str>
                    </if>
                    <if test="exchange_ccy_code!=null &amp;&amp; exchange_ccy_code!=''" type="If">
                        <str type="Str"><![CDATA[exchange_ccy_code=#exchange_ccy_code#]]></str>
                    </if>
                    <if test="exchange_rate_unit!=null &amp;&amp; exchange_rate_unit!=''" type="If">
                        <str type="Str"><![CDATA[exchange_rate_unit=#exchange_rate_unit#]]></str>
                    </if>
                </and>
            </where>
        </dynamicSql>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[select * from glb_exchange_rate]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[corpno = #org_id#]]></str>
                    <if test="trxn_date!=null &amp;&amp; trxn_date!=''" type="If">
                        <str type="Str"><![CDATA[trxn_date=#trxn_date#]]></str>
                    </if>
                    <if test="ccy_code!=null &amp;&amp; ccy_code!=''" type="If">
                        <str type="Str"><![CDATA[ccy_code=#ccy_code#]]></str>
                    </if>
                    <if test="exchange_ccy_code!=null &amp;&amp; exchange_ccy_code!=''" type="If">
                        <str type="Str"><![CDATA[exchange_ccy_code=#exchange_ccy_code#]]></str>
                    </if>
                    <if test="exchange_rate_unit!=null &amp;&amp; exchange_rate_unit!=''" type="If">
                        <str type="Str"><![CDATA[exchange_rate_unit=#exchange_rate_unit#]]></str>
                    </if>
                </and>
            </where>
        </dynamicSql>
        <dynamicSql type="db2">
            <str type="Str"><![CDATA[select * from glb_exchange_rate]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[corpno = #org_id#]]></str>
                    <if test="trxn_date!=null &amp;&amp; trxn_date!=''" type="If">
                        <str type="Str"><![CDATA[trxn_date=#trxn_date#]]></str>
                    </if>
                    <if test="ccy_code!=null &amp;&amp; ccy_code!=''" type="If">
                        <str type="Str"><![CDATA[ccy_code=#ccy_code#]]></str>
                    </if>
                    <if test="exchange_ccy_code!=null &amp;&amp; exchange_ccy_code!=''" type="If">
                        <str type="Str"><![CDATA[exchange_ccy_code=#exchange_ccy_code#]]></str>
                    </if>
                    <if test="exchange_rate_unit!=null &amp;&amp; exchange_rate_unit!=''" type="If">
                        <str type="Str"><![CDATA[exchange_rate_unit=#exchange_rate_unit#]]></str>
                    </if>
                </and>
            </where>
        </dynamicSql>
    </dynamicSelect>
    <select cache="none" method="selectAll" type="sql" id="lstExchangeRate" longname="折算汇率查询">
        <sql type="oracle"><![CDATA[select * from glb_exchange_rate where corpno = #org_id#]]></sql>
        <sql type="db2"><![CDATA[select * from glb_exchange_rate where corpno = #org_id#]]></sql>
        <sql type="mysql"><![CDATA[select * from glb_exchange_rate where corpno = #org_id#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="GlExchange.GlExchangeRateInfo"/>
    </select>
</sqls>
