<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sqls xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="FaAccounting" longname="核算相关SQL" package="cn.sunline.ltts.busi.fa.namedsql" xsi:noNamespaceSchemaLocation="ltts-model.xsd">
    <select cache="none" method="selectOne" type="sql" id="selMaxSortBySetNo" longname="查询同一个套号的最大的序号">
        <sql type="mysql"><![CDATA[
        select
                ifnull(max(a.data_sort), 0) as data_sort 
        from
                fab_set_accounts_detail a 
        where
                a.corpno=#org_id# and a.set_account_no=#set_account_no# 
        ]]></sql>
        <sql type="oracle"><![CDATA[
        select
                nvl(max(a.data_sort), 0) as data_sort 
        from
                fab_set_accounts_detail a 
        where
                a.corpno=#org_id# and a.set_account_no=#set_account_no# 
        ]]></sql>
        <sql type="db2"><![CDATA[
        select
                value(max(a.data_sort), 0) as data_sort 
        from
                fab_set_accounts_detail a 
        where
                a.corpno=#org_id# and a.set_account_no=#set_account_no# 
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="set_account_no" ref="GlDict.A.set_account_no" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="套号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="long"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstSummaySetAccountDetail" longname="汇总账套明细">
        <sql type="oracle"><![CDATA[
        select a.ccy_code, 
                nvl(sum( case when a.debit_credit='D' then a.accounting_amt else 0.00 end ),0.00 ) as debit_amt, 
                nvl(sum( case when a.debit_credit='C' then a.accounting_amt else 0.00 end),0.00) as credit_amt,
                nvl(sum(case when a.debit_credit='D' then a.accounting_amt else (0.00-a.accounting_amt)end),0.00 )as debit_creit_margin, 
                nvl(sum(case when a.debit_credit='D' then 1 else 0 end),0) as debit_count, 
                nvl(sum(case when a.debit_credit='C' then 1 else 0 end),0) as creit_count 
        from
                fab_set_accounts_main b 
        left join
                fab_set_accounts_detail a 
        on      b.corpno = a.corpno and b.set_account_no = a.set_account_no 
        where
                b.set_account_no=#set_account_no# 
        and     b.corpno=#org_id# 
        group by
                a.ccy_code
        ]]></sql>
        <sql type="mysql"><![CDATA[
        select
                a.ccy_code, ifnull(sum( case when a.debit_credit='D' then a.accounting_amt else 0.00 end ),0.00 ) as debit_amt, ifnull(sum( case when a.debit_credit='C' then a.accounting_amt else 0.00 end),0.00) as credit_amt,
                ifnull(sum(case when a.debit_credit='D' then a.accounting_amt else (0.00-a.accounting_amt)end),0.00 )as debit_creit_margin, ifnull(sum(case when a.debit_credit='D' then 1 else 0 end),0) as debit_count, ifnull(sum(case when a.debit_credit='C' then 1 else 0 end),
                0) as creit_count 
        from
                fab_set_accounts_main b 
        left join
                fab_set_accounts_detail a 
                        on b.corpno = a.corpno and b.set_account_no = a.set_account_no 
        where
                b.set_account_no=#set_account_no# 
                and b.corpno=#org_id# 
        group by
                a.ccy_code 
        ]]></sql>
        <sql type="db2"><![CDATA[
        select a.ccy_code, 
                value(sum( case when a.debit_credit='D' then a.accounting_amt else 0.00 end ),0.00 ) as debit_amt, 
                value(sum( case when a.debit_credit='C' then a.accounting_amt else 0.00 end),0.00) as credit_amt,
                value(sum(case when a.debit_credit='D' then a.accounting_amt else (0.00-a.accounting_amt)end),0.00 )as debit_creit_margin, 
                value(sum(case when a.debit_credit='D' then 1 else 0 end),0) as debit_count, 
                value(sum(case when a.debit_credit='C' then 1 else 0 end),0) as creit_count 
        from
                fab_set_accounts_main b 
        left join
                fab_set_accounts_detail a 
        on      b.corpno = a.corpno and b.set_account_no = a.set_account_no 
        where
                b.set_account_no=#set_account_no# 
        and     b.corpno=#org_id# 
        group by
                a.ccy_code
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="set_account_no" ref="GlDict.A.set_account_no" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="套号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="ComFaAccounting.FaSummarySetAccountDetail"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstSetDetailByNo" longname="根据套号取套号明细">
        <sql type="oracle"><![CDATA[   select
            * 
      from
            fab_set_accounts_detail a 
      where
            a.corpno=#org_id# and a.set_account_no=#set_account_no#
      order by
            a.ccy_code, a.data_sort
      ]]></sql>
        <sql type="db2"><![CDATA[   select
            * 
      from
            fab_set_accounts_detail a 
      where
            a.corpno=#org_id# and a.set_account_no=#set_account_no#
      order by
            a.ccy_code, a.data_sort
      ]]></sql>
        <sql type="mysql"><![CDATA[   select
            * 
      from
            fab_set_accounts_detail a 
      where
            a.corpno=#org_id# and a.set_account_no=#set_account_no#
      order by
            a.ccy_code, a.data_sort
      ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="set_account_no" ref="GlDict.A.set_account_no" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="套号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="TabFaRegBook.fab_set_accounts_detail"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstNoBalanceCount" longname="借贷不平衡">
        <sql type="mysql"><![CDATA[
            select
                    a.trxn_ccy,ifnull(sum( case a.debit_credit when 'D' then a.accounting_amt else -a.accounting_amt end ),0.00) as accounting_amt 
            from
                    fab_accounting_voch a 
            where
                    a.trxn_seq=#trxn_seq# and a.corpno=#org_id# and trxn_date = #trxn_date# and on_bal_sheet_ind='Y'
            group by
                    a.trxn_ccy 
            having
                    (
                            sum( case a.debit_credit when 'D' then a.accounting_amt else -a.accounting_amt end )!= 0 
                    )
        ]]></sql>
        <sql type="oracle"><![CDATA[
            select
                    a.trxn_ccy,nvl(sum( case a.debit_credit when 'D' then a.accounting_amt else -a.accounting_amt end ),0.00) as accounting_amt 
            from
                    fab_accounting_voch a 
            where
                    a.trxn_seq=#trxn_seq# and a.corpno=#org_id# 
                    and trxn_date = #trxn_date # 
            group by
                    a.trxn_ccy 
            having
                    (
                            sum( case a.debit_credit when 'D' then a.accounting_amt else -a.accounting_amt end )!= 0 
                    ) 
        ]]></sql>
        <sql type="db2"><![CDATA[
            select
                    a.trxn_ccy,value(sum( case a.debit_credit when 'D' then a.accounting_amt else -a.accounting_amt end ),0.00) as accounting_amt 
            from
                    fab_accounting_voch a 
            where
                    a.trxn_seq=#trxn_seq# and a.corpno=#org_id# 
                    and trxn_date = #trxn_date # 
            group by
                    a.trxn_ccy 
            having
                    (
                            sum( case a.debit_credit when 'D' then a.accounting_amt else -a.accounting_amt end )!= 0 
                    ) 
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_seq" ref="GlDict.A.trxn_seq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="交易流水" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="ComFaAccounting.FaDebitAndCrebitBalance"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstLedgerBalance" longname="外部余额汇总">
        <sql type="oracle"><![CDATA[select
                corpno as org_id, sys_no,trxn_date,acct_branch,ccy_code,
                gl_code,'D' as ledger_bal_direction,
                        sum(case when bal_type = 'D' then acct_bal
                        else acct_bal*(-1) end)
                        as ledger_acct_bal 
        from
                fab_ledger_check_seq 
        where
                trxn_date=#trxn_date# and sys_no = #sys_no# and corpno=#org_id# and analysis_state='2'
        group by
                corpno,sys_no,trxn_date,
                acct_branch,ccy_code,gl_code]]></sql>
        <sql type="db2"><![CDATA[select
                corpno as org_id, sys_no,trxn_date,acct_branch,ccy_code,
                gl_code,'D' as ledger_bal_direction,
                        sum(case when bal_type = 'D' then acct_bal
                        else acct_bal*(-1) end)
                        as ledger_acct_bal 
        from
                fab_ledger_check_seq 
        where
                trxn_date=#trxn_date# and sys_no = #sys_no# and corpno=#org_id# and analysis_state='2'
        group by
                corpno,sys_no,trxn_date,
                acct_branch,ccy_code,gl_code]]></sql>
        <sql type="mysql"><![CDATA[select
                corpno as org_id, sys_no,trxn_date,acct_branch,ccy_code,
                gl_code,'D' as ledger_bal_direction,
                        sum(case when bal_type = 'D' then acct_bal
                        else acct_bal*(-1) end)
                        as ledger_acct_bal 
        from
                fab_ledger_check_seq 
        where
                trxn_date=#trxn_date# and sys_no = #sys_no# and corpno=#org_id# and analysis_state='2'
        group by
                corpno,sys_no,trxn_date,
                acct_branch,ccy_code,gl_code]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="sys_no" ref="GlDict.A.sys_no" jdbcType="VARCHAR" javaType="GlBaseType.U_SYSNO" mode="in" longname="系统编号" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="ComFaAccounting.FaLedgerCheckSeqInfo"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstAccountingData" longname="按机构、系统、科目、记账方向和币种分组取记账数据">
        <sql type="mysql"><![CDATA[
        select
                count(1) as total_count,a.acct_branch,a.trxn_ccy,a.gl_code, a.debit_credit ,
                a.sys_no ,ifnull(sum(a.trxn_amt),0.00) as total_amt ,a.sub_acct_seq
        from
                fab_accounting_seq a 
        where
                a.trxn_date = #trxn_date# and a.total_batch_no=#total_batch_no#
        group by
                a.acct_branch,a.trxn_ccy,a.gl_code,
                a.debit_credit ,a.sys_no ,a.sub_acct_seq
        ]]></sql>
        <sql type="oracle"><![CDATA[
        select
                count(1) as total_count,a.acct_branch,a.trxn_ccy,a.gl_code, a.debit_credit ,
                a.sys_no ,nvl(sum(a.trxn_amt),0.00) as total_amt, a.sub_acct_seq
        from
                fab_accounting_seq a 
        where
                a.trxn_date = #trxn_date# and a.total_batch_no=#total_batch_no#
        group by
                a.acct_branch,a.trxn_ccy,a.gl_code,
                a.debit_credit,a.sys_no, a.sub_acct_seq
        ]]></sql>
        <sql type="db2"><![CDATA[
        select
                count(1) as total_count,a.acct_branch,a.trxn_ccy,a.gl_code, a.debit_credit ,
                a.sys_no ,value(sum(a.trxn_amt),0.00) as total_amt,a.sub_acct_seq 
        from
                fab_accounting_seq a 
        where
                and a.trxn_date = #trxn_date# and a.total_batch_no=#total_batch_no# 
        group by
                a.acct_branch,a.trxn_ccy,a.gl_code,
                a.debit_credit,a.sys_no,a.sub_acct_seq
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="transaction date" parameterType="condition"/>
            <parameter property="total_batch_no" ref="GlDict.A.total_batch_no" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="汇总批次号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="ComFaAccounting.FaAccountingData"/>
    </select>
    <update method="update" id="updTotalBatchNo" longname="更新记账数据的批次号和状态">
        <sql type="mysql"><![CDATA[update
                fab_accounting_seq a 
        set
                a.total_batch_no=#total_batch_no# ,a.trxn_seq_status='3' 
        where
                a.trxn_date=#trxn_date# and a.corpno=#org_id# 
                and a.hash_value = #hash_value#	
                and a.trxn_seq_status=#trxn_seq_status# ]]></sql>
        <sql type="oracle"><![CDATA[
        update
                fab_accounting_seq a 
        set
                a.total_batch_no=#total_batch_no# ,a.trxn_seq_status='3' 
        where
                a.trxn_date=#trxn_date# and a.corpno=#org_id# 
                and a.hash_value = #hash_value#
                and a.trxn_seq_status=#trxn_seq_status# and rownum<= #total_count# 
                
        ]]></sql>
        <sql type="db2"><![CDATA[
        update
                fab_accounting_seq a 
        set
                a.total_batch_no=#total_batch_no# ,a.trxn_seq_status='3' 
        where
                a.trxn_date=#trxn_date# and a.corpno=#org_id# 
                and a.hash_value = #hash_value#
                and a.trxn_seq_status=#trxn_seq_status# and rownum<= #total_count# 
                
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="total_batch_no" ref="GlDict.A.total_batch_no" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="汇总批次号" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="total_count" ref="GlDict.A.total_count" jdbcType="VARCHAR" javaType="GlBaseType.U_LONG" mode="in" longname="总记录数" parameterType="condition"/>
            <parameter property="trxn_seq_status" ref="GlDict.A.trxn_seq_status" jdbcType="VARCHAR" javaType="GlBusinessType.E_TRXNSEQSTATE" mode="in" longname="交易流水状态" parameterType="condition"/>
            <parameter property="hash_value" ref="GlDict.A.hash_value" jdbcType="VARCHAR" javaType="GlBaseType.U_LONG" mode="in" longname="散列值" parameterType="condition"/>
        </parameterMap>
    </update>
    <select cache="none" method="selectAll" type="sql" id="lstHashValueFromAccounting" longname="查询散列值">
        <sql type="oracle"><![CDATA[
        select
                distinct a.hash_value 
        from
                fab_accounting_seq a 
        where
                a.trxn_date=#trxn_date# and a.corpno=#org_id# 
                and a.trxn_seq_status=#trxn_seq_status#
        ]]></sql>
        <sql type="db2"><![CDATA[
        select
                distinct a.hash_value 
        from
                fab_accounting_seq a 
        where
                a.trxn_date=#trxn_date# and a.corpno=#org_id# 
                and a.trxn_seq_status=#trxn_seq_status#
        ]]></sql>
        <sql type="mysql"><![CDATA[
        select
                distinct a.hash_value 
        from
                fab_accounting_seq a 
        where
                a.trxn_date=#trxn_date# and a.corpno=#org_id# 
                and a.trxn_seq_status=#trxn_seq_status#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="trxn_seq_status" ref="GlDict.A.trxn_seq_status" jdbcType="VARCHAR" javaType="GlBusinessType.E_TRXNSEQSTATE" mode="in" longname="交易流水状态" parameterType="condition"/>
        </parameterMap>
        <resultMap class="ComFaApFile.ApDataGroupNo"/>
    </select>
    <update method="update" id="updFailureStatus" longname="入账失败状态更新">
        <sql type="oracle"><![CDATA[
        update
                fab_accounting_seq a 
        set
                a.trxn_seq_status='4' 
        where
                a.total_batch_no=#total_batch_no# and a.corpno=#org_id#
        ]]></sql>
        <sql type="db2"><![CDATA[
        update
                fab_accounting_seq a 
        set
                a.trxn_seq_status='4' 
        where
                a.total_batch_no=#total_batch_no# and a.corpno=#org_id#
        ]]></sql>
        <sql type="mysql"><![CDATA[
        update
                fab_accounting_seq a 
        set
                a.trxn_seq_status='4' 
        where
                a.total_batch_no=#total_batch_no# and a.corpno=#org_id#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="total_batch_no" ref="GlDict.A.total_batch_no" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="汇总批次号" parameterType="condition"/>
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </update>
    <dynamicSelect cache="none" method="selectPageWithCount" type="sql" id="lstFabAccureInfo" longname="计提登记簿信息查询">
        <parameterMap class="java.util.Map">
            <parameter property="sys_no" ref="GlDict.A.sys_no" jdbcType="VARCHAR" javaType="GlBaseType.U_SYSNO" mode="in" longname="系统编号" parameterType="condition"/>
            <parameter property="accrue_date" ref="GlDict.A.accrue_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="accrue_type" ref="GlDict.A.accrue_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_ACCRUETYPE" mode="in" longname="计提种类" parameterType="condition"/>
            <parameter property="accrue_branch" ref="GlDict.A.accrue_branch" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="计提机构" parameterType="condition"/>
            <parameter property="ccy_code" ref="GlDict.A.ccy_code" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="货币代码" parameterType="condition"/>
            <parameter property="budget_inst_amt" ref="GlDict.A.budget_inst_amt" jdbcType="VARCHAR" javaType="BaseType.U_TRANAM" mode="in" longname="计提金额" parameterType="condition"/>
            <parameter property="accrue_gl_code" ref="GlDict.A.accrue_gl_code" jdbcType="VARCHAR" javaType="GlBaseType.U_SUBJECTNO" mode="in" longname="计提科目" parameterType="condition"/>
            <parameter property="analysis_state" ref="GlDict.A.analysis_state" jdbcType="VARCHAR" javaType="GlBusinessType.E_ANALYSISSTATE" mode="in" longname="解析状态" parameterType="condition"/>
            <parameter property="offset_gl_code" ref="GlDict.A.offset_gl_code" jdbcType="VARCHAR" javaType="GlBaseType.U_SUBJECTNO" mode="in" longname="对方科目" parameterType="condition"/>
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="ComFabAccrue.FabAccureQueryOut"/>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[select * from fab_accrue]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[corpno = #org_id#]]></str>
                    <if test="sys_no!=null &amp;&amp; sys_no!=''" type="If">
                        <str type="Str"><![CDATA[sys_no=#sys_no#]]></str>
                    </if>
                    <if test="accrue_date!=null &amp;&amp; accrue_date!=''" type="If">
                        <str type="Str"><![CDATA[accrue_date=#accrue_date#]]></str>
                    </if>
                    <if test="accrue_type!=null" type="If">
                        <str type="Str"><![CDATA[accrue_type=#accrue_type#]]></str>
                    </if>
                    <if test="accrue_branch!=null &amp;&amp; accrue_branch!=''" type="If">
                        <str type="Str"><![CDATA[acct_branch=#accrue_branch#]]></str>
                    </if>
                    <if test="ccy_code!=null &amp;&amp; ccy_code!=''" type="If">
                        <str type="Str"><![CDATA[ccy_code =#ccy_code#]]></str>
                    </if>
                    <if test="budget_inst_amt!=null &amp;&amp; budget_inst_amt!=''" type="If">
                        <str type="Str"><![CDATA[budget_inst_amt=#budget_inst_amt#]]></str>
                    </if>
                    <if test="accrue_gl_code!=null &amp;&amp; accrue_gl_code!=''" type="If">
                        <str type="Str"><![CDATA[accrue_gl_code=#accrue_gl_code#]]></str>
                    </if>
                    <if test="offset_gl_code!=null &amp;&amp; offset_gl_code!=''" type="If">
                        <str type="Str"><![CDATA[offset_gl_code=#offset_gl_code#]]></str>
                    </if>
                    <if test="analysis_state!=null" type="If">
                        <str type="Str"><![CDATA[analysis_state=#analysis_state#]]></str>
                    </if>
                </and>
            </where>
        </dynamicSql>
        <dynamicSql type="db2">
            <str type="Str"><![CDATA[select * from fab_accrue]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[corpno = #org_id#]]></str>
                    <if test="sys_no!=null &amp;&amp; sys_no!=''" type="If">
                        <str type="Str"><![CDATA[sys_no=#sys_no#]]></str>
                    </if>
                    <if test="accrue_date!=null &amp;&amp; accrue_date!=''" type="If">
                        <str type="Str"><![CDATA[accrue_date=#accrue_date#]]></str>
                    </if>
                    <if test="accrue_type!=null" type="If">
                        <str type="Str"><![CDATA[accrue_type=#accrue_type#]]></str>
                    </if>
                    <if test="accrue_branch!=null &amp;&amp; accrue_branch!=''" type="If">
                        <str type="Str"><![CDATA[acct_branch=#accrue_branch#]]></str>
                    </if>
                    <if test="ccy_code!=null &amp;&amp; ccy_code!=''" type="If">
                        <str type="Str"><![CDATA[ccy_code =#ccy_code#]]></str>
                    </if>
                    <if test="budget_inst_amt!=null &amp;&amp; budget_inst_amt!=''" type="If">
                        <str type="Str"><![CDATA[budget_inst_amt=#budget_inst_amt#]]></str>
                    </if>
                    <if test="accrue_gl_code!=null &amp;&amp; accrue_gl_code!=''" type="If">
                        <str type="Str"><![CDATA[accrue_gl_code=#accrue_gl_code#]]></str>
                    </if>
                    <if test="offset_gl_code!=null &amp;&amp; offset_gl_code!=''" type="If">
                        <str type="Str"><![CDATA[offset_gl_code=#offset_gl_code#]]></str>
                    </if>
                    <if test="analysis_state!=null" type="If">
                        <str type="Str"><![CDATA[analysis_state=#analysis_state#]]></str>
                    </if>
                </and>
            </where>
        </dynamicSql>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[select * from fab_accrue]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[corpno = #org_id#]]></str>
                    <if test="sys_no!=null &amp;&amp; sys_no!=''" type="If">
                        <str type="Str"><![CDATA[sys_no=#sys_no#]]></str>
                    </if>
                    <if test="accrue_date!=null &amp;&amp; accrue_date!=''" type="If">
                        <str type="Str"><![CDATA[accrue_date=#accrue_date#]]></str>
                    </if>
                    <if test="accrue_type!=null" type="If">
                        <str type="Str"><![CDATA[accrue_type=#accrue_type#]]></str>
                    </if>
                    <if test="accrue_branch!=null &amp;&amp; accrue_branch!=''" type="If">
                        <str type="Str"><![CDATA[acct_branch=#accrue_branch#]]></str>
                    </if>
                    <if test="ccy_code!=null &amp;&amp; ccy_code!=''" type="If">
                        <str type="Str"><![CDATA[ccy_code =#ccy_code#]]></str>
                    </if>
                    <if test="budget_inst_amt!=null &amp;&amp; budget_inst_amt!=''" type="If">
                        <str type="Str"><![CDATA[budget_inst_amt=#budget_inst_amt#]]></str>
                    </if>
                    <if test="accrue_gl_code!=null &amp;&amp; accrue_gl_code!=''" type="If">
                        <str type="Str"><![CDATA[accrue_gl_code=#accrue_gl_code#]]></str>
                    </if>
                    <if test="offset_gl_code!=null &amp;&amp; offset_gl_code!=''" type="If">
                        <str type="Str"><![CDATA[offset_gl_code=#offset_gl_code#]]></str>
                    </if>
                    <if test="analysis_state!=null" type="If">
                        <str type="Str"><![CDATA[analysis_state=#analysis_state#]]></str>
                    </if>
                </and>
            </where>
        </dynamicSql>
    </dynamicSelect>
    <update method="update" id="updLedgerBalanceStatus" longname="更新分户余额状态更新">
        <sql type="oracle"><![CDATA[
        update
                fab_ledger_check_seq a 
        set
                a.analysis_state=#analysis_state# 
        where
                trxn_date=#trxn_date# and corpno=#org_id# and sys_no=#sys_no#
                and acct_branch=#acct_branch# and ccy_code=#ccy_code# and gl_code=#gl_code# 
                and bal_type=#bal_type#   
        ]]></sql>
        <sql type="db2"><![CDATA[
        update
                fab_ledger_check_seq a 
        set
                a.analysis_state=#analysis_state# 
        where
                trxn_date=#trxn_date# and corpno=#org_id# and sys_no=#sys_no#
                and acct_branch=#acct_branch# and ccy_code=#ccy_code# and gl_code=#gl_code# 
                and bal_type=#bal_type#   
        ]]></sql>
        <sql type="mysql"><![CDATA[
        update
                fab_ledger_check_seq a 
        set
                a.analysis_state=#analysis_state# 
        where
                trxn_date=#trxn_date# and corpno=#org_id# and sys_no=#sys_no#
                and acct_branch=#acct_branch# and ccy_code=#ccy_code# and gl_code=#gl_code# 
                and bal_type=#bal_type#   
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="analysis_state" ref="GlDict.A.analysis_state" jdbcType="VARCHAR" javaType="GlBusinessType.E_ANALYSISSTATE" mode="in" longname="解析状态" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="transaction date" parameterType="condition"/>
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="organization id" parameterType="condition"/>
            <parameter property="sys_no" ref="GlDict.A.sys_no" jdbcType="VARCHAR" javaType="GlBaseType.U_SYSNO" mode="in" longname="系统编号" parameterType="condition"/>
            <parameter property="acct_branch" ref="GlDict.A.acct_branch" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="账务机构" parameterType="condition"/>
            <parameter property="ccy_code" ref="GlDict.A.ccy_code" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="currency code" parameterType="condition"/>
            <parameter property="gl_code" ref="GlDict.A.gl_code" jdbcType="VARCHAR" javaType="GlBaseType.U_SUBJECTNO" mode="in" longname="科目号" parameterType="condition"/>
            <parameter property="bal_type" ref="GlDict.A.bal_type" jdbcType="VARCHAR" javaType="GlEnumType.E_DEBITCREDIT" mode="in" longname="分账余额方向" parameterType="condition"/>
        </parameterMap>
    </update>
    <select cache="none" method="selectOne" type="sql" id="cntGlCodeNum" longname="查询一级科目以及子科目总数">
        <sql type="oracle"><![CDATA[
        select count(*) from fap_accounting_subject where gl_code like concat(#gl_code#,'%') and corpno=#org_id#
        ]]></sql>
        <sql type="db2"><![CDATA[
        select count(*) from fap_accounting_subject where gl_code like concat(#gl_code#,'%') and corpno=#org_id#
        ]]></sql>
        <sql type="mysql"><![CDATA[
        select count(*) from fap_accounting_subject where gl_code like concat(#gl_code#,'%') and corpno=#org_id#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="gl_code" ref="GlDict.A.gl_code" jdbcType="VARCHAR" javaType="GlBaseType.U_SUBJECTNO" mode="in" longname="科目号" parameterType="condition"/>
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <dynamicSelect cache="none" method="selectPageWithCount" type="sql" id="lstSetDetailsByData" longname="根据日期、柜员号、科目号、账号获取套账明细">
        <parameterMap class="java.util.Map">
            <parameter property="start_date" ref="GlDict.A.start_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="起始日期" parameterType="condition"/>
            <parameter property="end_date" ref="GlDict.A.end_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="截止日期" parameterType="condition"/>
            <parameter property="trxn_teller" ref="GlDict.A.trxn_teller" jdbcType="VARCHAR" javaType="GlBaseType.U_USERID" mode="in" longname="交易柜员" parameterType="condition"/>
            <parameter property="gl_code" ref="GlDict.A.gl_code" jdbcType="VARCHAR" javaType="GlBaseType.U_SUBJECTNO" mode="in" longname="科目号" parameterType="condition"/>
            <parameter property="acct_no" ref="GlDict.A.acct_no" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="账号" parameterType="condition"/>
            <parameter property="set_account_no" ref="GlDict.A.set_account_no" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="套号" parameterType="condition"/>
            <parameter property="accounting_amt" ref="GlDict.A.accounting_amt" jdbcType="VARCHAR" javaType="BaseType.U_TRANAM" mode="in" longname="记账金额" parameterType="condition"/>
            <parameter property="ccy_code" ref="GlDict.A.ccy_code" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="币种" parameterType="condition"/>
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="ComFaAccounting.FaQuerySetAccountsOut"/>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[select m.set_account_no,m.sys_no,m.set_account_status,m.trxn_date,m.trxn_teller,m.posting_teller ,m.trxn_seq,m.subject_accounting_ind,m.posting_date,d.summary_code,d.summary_desc,d.remark,d.acct_branch,d.rebuwa
from 
    fab_set_accounts_detail d 
left join
    fab_set_accounts_main m
on
 d.set_account_no = m.set_account_no and d.corpno = m.corpno]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[m.corpno = #org_id#]]></str>
                    <str type="Str"><![CDATA[m.trxn_date>=#start_date#]]></str>
                    <str type="Str"><![CDATA[m.trxn_date<=#end_date#]]></str>
                    <str type="Str"><![CDATA[m.trxn_teller=#trxn_teller#]]></str>
                    <if test="gl_code!=null &amp;&amp; gl_code!=''" type="If">
                        <str type="Str"><![CDATA[d.gl_code like concat('%',concat(#gl_code#,'%'))]]></str>
                    </if>
                    <if test="acct_no!=null &amp;&amp; acct_no!=''" type="If">
                        <str type="Str"><![CDATA[d.acct_no=#acct_no#]]></str>
                    </if>
                    <if test="set_account_no!=null &amp;&amp; set_account_no!=''" type="If">
                        <str type="Str"><![CDATA[d.set_account_no=#set_account_no#]]></str>
                    </if>
                    <if test="accounting_amt!=null &amp;&amp; accounting_amt!=''" type="If">
                        <str type="Str"><![CDATA[d.accounting_amt=#accounting_amt#]]></str>
                    </if>
                    <if test="ccy_code!=null &amp;&amp; ccy_code!=''" type="If">
                        <str type="Str"><![CDATA[d.ccy_code=#ccy_code#]]></str>
                    </if>
                </and>
            </where>
            <str type="Str"><![CDATA[order by m.trxn_date,m.sys_no,d.set_account_no,m.trxn_seq]]></str>
        </dynamicSql>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[select m.set_account_no,m.sys_no,m.set_account_status,m.trxn_date,m.trxn_teller,m.posting_teller ,m.trxn_seq,m.subject_accounting_ind,m.posting_date,d.summary_code,d.summary_desc,d.remark,d.acct_branch,d.rebuwa
from 
    fab_set_accounts_detail d 
left join
    fab_set_accounts_main m
on
 d.set_account_no = m.set_account_no and d.corpno = m.corpno]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[m.corpno = #org_id#]]></str>
                    <str type="Str"><![CDATA[m.trxn_date>=#start_date#]]></str>
                    <str type="Str"><![CDATA[m.trxn_date<=#end_date#]]></str>
                    <str type="Str"><![CDATA[m.trxn_teller=#trxn_teller#]]></str>
                    <if test="gl_code!=null &amp;&amp; gl_code!=''" type="If">
                        <str type="Str"><![CDATA[d.gl_code like concat('%',concat(#gl_code#,'%'))]]></str>
                    </if>
                    <if test="acct_no!=null &amp;&amp; acct_no!=''" type="If">
                        <str type="Str"><![CDATA[d.acct_no=#acct_no#]]></str>
                    </if>
                    <if test="set_account_no!=null &amp;&amp; set_account_no!=''" type="If">
                        <str type="Str"><![CDATA[d.set_account_no=#set_account_no#]]></str>
                    </if>
                    <if test="accounting_amt!=null &amp;&amp; accounting_amt!=''" type="If">
                        <str type="Str"><![CDATA[d.accounting_amt=#accounting_amt#]]></str>
                    </if>
                    <if test="ccy_code!=null &amp;&amp; ccy_code!=''" type="If">
                        <str type="Str"><![CDATA[d.ccy_code=#ccy_code#]]></str>
                    </if>
                </and>
            </where>
            <str type="Str"><![CDATA[order by m.trxn_date,m.sys_no,d.set_account_no,m.trxn_seq]]></str>
        </dynamicSql>
        <dynamicSql type="db2">
            <str type="Str"><![CDATA[select m.set_account_no,m.sys_no,m.set_account_status,m.trxn_date,m.trxn_teller,m.posting_teller ,m.trxn_seq,m.subject_accounting_ind,m.posting_date,d.summary_code,d.summary_desc,d.remark,d.acct_branch,d.rebuwa
from 
    fab_set_accounts_detail d 
left join
    fab_set_accounts_main m
on
 d.set_account_no = m.set_account_no and d.corpno = m.corpno]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[m.corpno = #org_id#]]></str>
                    <str type="Str"><![CDATA[m.trxn_date>=#start_date#]]></str>
                    <str type="Str"><![CDATA[m.trxn_date<=#end_date#]]></str>
                    <str type="Str"><![CDATA[m.trxn_teller=#trxn_teller#]]></str>
                    <if test="gl_code!=null &amp;&amp; gl_code!=''" type="If">
                        <str type="Str"><![CDATA[d.gl_code like concat('%',concat(#gl_code#,'%'))]]></str>
                    </if>
                    <if test="acct_no!=null &amp;&amp; acct_no!=''" type="If">
                        <str type="Str"><![CDATA[d.acct_no=#acct_no#]]></str>
                    </if>
                    <if test="set_account_no!=null &amp;&amp; set_account_no!=''" type="If">
                        <str type="Str"><![CDATA[d.set_account_no=#set_account_no#]]></str>
                    </if>
                    <if test="accounting_amt!=null &amp;&amp; accounting_amt!=''" type="If">
                        <str type="Str"><![CDATA[d.accounting_amt=#accounting_amt#]]></str>
                    </if>
                    <if test="ccy_code!=null &amp;&amp; ccy_code!=''" type="If">
                        <str type="Str"><![CDATA[d.ccy_code=#ccy_code#]]></str>
                    </if>
                </and>
            </where>
            <str type="Str"><![CDATA[order by m.trxn_date,m.sys_no,d.set_account_no,m.trxn_seq]]></str>
        </dynamicSql>
    </dynamicSelect>
    <dynamicSelect cache="none" method="selectPageWithCount" type="sql" id="lstFaacountSeq" longname="查询总账流水（分页查询）">
        <parameterMap class="java.util.Map">
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="trxn_seq" ref="GlDict.A.trxn_seq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="交易流水" parameterType="condition"/>
            <parameter property="acct_branch" ref="GlDict.A.acct_branch" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="账务机构" parameterType="condition"/>
            <parameter property="gl_code" ref="GlDict.A.gl_code" jdbcType="VARCHAR" javaType="GlBaseType.U_SUBJECTNO" mode="in" longname="科目号" parameterType="condition"/>
            <parameter property="trxn_ccy" ref="GlDict.A.trxn_ccy" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="交易币种" parameterType="condition"/>
        </parameterMap>
        <resultMap class="ComFaAccount.FaAcctingSeqOut"/>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[select d.trxn_date,d.trxn_seq,d.sys_no,d.acct_branch,d.trxn_ccy,d.debit_credit,d.trxn_amt,d.accounting_alias,d.accounting_subject,d.bal_attributes,d.gl_code,m.GL_CODE_DESC,d.trxn_seq_status
from 
    fab_accounting_seq d 
left join
    fap_accounting_subject m
on
 d.GL_CODE = m.GL_CODE]]></str>
            <where type="Where">
                <and type="And">
                    <if test="trxn_date!=null &amp;&amp; trxn_date!=''" type="If">
                        <str type="Str"><![CDATA[d.trxn_date=#trxn_date#]]></str>
                    </if>
                    <if test="trxn_seq!=null &amp;&amp; trxn_seq!=''" type="If">
                        <str type="Str"><![CDATA[d.trxn_seq=#trxn_seq#]]></str>
                    </if>
                    <if test="acct_branch!=null &amp;&amp; acct_branch!=''" type="If">
                        <str type="Str"><![CDATA[d.acct_branch=#acct_branch#]]></str>
                    </if>
                    <if test="trxn_ccy!=null &amp;&amp; trxn_ccy!=''" type="If">
                        <str type="Str"><![CDATA[d.trxn_ccy=#trxn_ccy#]]></str>
                    </if>
                    <if test="gl_code!=null &amp;&amp; gl_code!=''" type="If">
                        <str type="Str"><![CDATA[d.gl_code =#gl_code#]]></str>
                    </if>
                </and>
            </where>
            <str type="Str"><![CDATA[order by d.trxn_date]]></str>
        </dynamicSql>
    </dynamicSelect>
    <dynamicSelect cache="none" method="selectAll" type="sql" id="lstFaacountSeq1" longname="查询总账流水全部数据">
        <parameterMap class="java.util.Map">
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="trxn_seq" ref="GlDict.A.trxn_seq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="交易流水" parameterType="condition"/>
            <parameter property="acct_branch" ref="GlDict.A.acct_branch" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="账务机构" parameterType="condition"/>
            <parameter property="gl_code" ref="GlDict.A.gl_code" jdbcType="VARCHAR" javaType="GlBaseType.U_SUBJECTNO" mode="in" longname="科目号" parameterType="condition"/>
            <parameter property="trxn_ccy" ref="GlDict.A.trxn_ccy" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="交易币种" parameterType="condition"/>
        </parameterMap>
        <resultMap class="ComFaAccount.FaAcctingSeqOut"/>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[select d.trxn_date,d.trxn_seq,d.sys_no,d.acct_branch,d.trxn_ccy,d.debit_credit,d.trxn_amt,d.accounting_alias,d.accounting_subject,d.bal_attributes,d.gl_code,m.GL_CODE_DESC,d.trxn_seq_status
from 
    fab_accounting_seq d 
left join
    fap_accounting_subject m
on
 d.GL_CODE = m.GL_CODE ]]></str>
            <where type="Where">
                <and type="And">
                    <if test="trxn_date!=null &amp;&amp; trxn_date!=''" type="If">
                        <str type="Str"><![CDATA[d.trxn_date=#trxn_date#]]></str>
                    </if>
                    <if test="trxn_seq!=null &amp;&amp; trxn_seq!=''" type="If">
                        <str type="Str"><![CDATA[d.trxn_seq=#trxn_seq#]]></str>
                    </if>
                    <if test="acct_branch!=null &amp;&amp; acct_branch!=''" type="If">
                        <str type="Str"><![CDATA[d.acct_branch=#acct_branch#]]></str>
                    </if>
                    <if test="trxn_ccy!=null &amp;&amp; trxn_ccy!=''" type="If">
                        <str type="Str"><![CDATA[d.trxn_ccy=#trxn_ccy#]]></str>
                    </if>
                    <if test="gl_code!=null &amp;&amp; gl_code!=''" type="If">
                        <str type="Str"><![CDATA[d.gl_code =#gl_code#]]></str>
                    </if>
                </and>
            </where>
            <str type="Str"><![CDATA[order by d.trxn_date]]></str>
        </dynamicSql>
    </dynamicSelect>
</sqls>
