<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sqls xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="FaRegBook" longname="核算登记簿命名sql" package="cn.sunline.ltts.busi.fa.namedsql" xsi:noNamespaceSchemaLocation="ltts-model.xsd">
    <select cache="none" method="selectAll" type="sql" id="lstAccureBookGroup" longname="查询某种类型计提登记簿">
        <sql type="oracle"><![CDATA[
    	select
    	    	a.accrue_type, a.sys_no, a.accrue_date, a.acct_branch, a.accrue_gl_code,
    	    	a.offset_gl_code, a.ccy_code, sum(a.budget_inst_amt) as budget_inst_amt, a.acct_seq 
    	from
    	    	fab_accrue a 
    	where
    	    	a.corpno = #org_id# and a.accrue_type = #accrue_type# 
    	    	and a.accrue_date=#accrue_date# and a.analysis_state=#analysis_state# 
    	group by
    	    	a.accrue_type, a.sys_no, a.accrue_date,
    	    	a.acct_branch, a.accrue_gl_code, a.offset_gl_code, a.ccy_code, a.acct_seq
    	]]></sql>
        <sql type="db2"><![CDATA[
    	select
    	    	a.accrue_type, a.sys_no, a.accrue_date, a.acct_branch, a.accrue_gl_code,
    	    	a.offset_gl_code, a.ccy_code, sum(a.budget_inst_amt) as budget_inst_amt, a.acct_seq 
    	from
    	    	fab_accrue a 
    	where
    	    	a.corpno = #org_id# and a.accrue_type = #accrue_type# 
    	    	and a.accrue_date=#accrue_date# and a.analysis_state=#analysis_state# 
    	group by
    	    	a.accrue_type, a.sys_no, a.accrue_date,
    	    	a.acct_branch, a.accrue_gl_code, a.offset_gl_code, a.ccy_code, a.acct_seq
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	a.accrue_type, a.sys_no, a.accrue_date, a.acct_branch, a.accrue_gl_code,
    	    	a.offset_gl_code, a.ccy_code, sum(a.budget_inst_amt) as budget_inst_amt, a.acct_seq 
    	from
    	    	fab_accrue a 
    	where
    	    	a.corpno = #org_id# and a.accrue_type = #accrue_type# 
    	    	and a.accrue_date=#accrue_date# and a.analysis_state=#analysis_state# 
    	group by
    	    	a.accrue_type, a.sys_no, a.accrue_date,
    	    	a.acct_branch, a.accrue_gl_code, a.offset_gl_code, a.ccy_code, a.acct_seq
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="accrue_date" ref="GlDict.A.accrue_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="accrue_type" ref="GlDict.A.accrue_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_ACCRUETYPE" mode="in" longname="计提种类" parameterType="condition"/>
            <parameter property="analysis_state" ref="GlDict.A.analysis_state" jdbcType="VARCHAR" javaType="GlBusinessType.E_ANALYSISSTATE" mode="in" longname="解析状态" parameterType="condition"/>
        </parameterMap>
        <resultMap class="ComFaRegBook.FaAccrueBook"/>
    </select>
    <update method="update" id="updAccureBook" longname="批量清算状态变更">
        <sql type="oracle"><![CDATA[UPDATE
    	    	fab_accrue a 
    	SET
    	    	a.analysis_state = '3' 
    	WHERE
    	    	a.corpno = #org_id# AND a.sys_no = #sys_no# 
    	    	AND a.accrue_date = #accrue_date# AND a.accrue_type = #accrue_type#  AND a.acct_branch = #acct_branch# 
    	    	AND a.accrue_gl_code = #accrue_gl_code# 
				AND a.offset_gl_code = #offset_gl_code# 
				AND a.analysis_state = '2' ]]></sql>
        <sql type="db2"><![CDATA[
    	UPDATE
    	    	fab_accrue a 
    	SET
    	    	a.analysis_state = '3' 
    	WHERE
    	    	a.corpno = #org_id# AND a.sys_no = #sys_no# 
    	    	AND a.accrue_date = #accrue_date# AND a.accrue_type = #accrue_type#  AND a.acct_branch = #acct_branch# 
    	    	AND a.accrue_gl_code = #accrue_gl_code# AND a.analysis_state = '2' 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	UPDATE
    	    	fab_accrue a 
    	SET
    	    	a.analysis_state = '3' 
    	WHERE
    	    	a.corpno = #org_id# AND a.sys_no = #sys_no# 
    	    	AND a.accrue_date = #accrue_date# AND a.accrue_type = #accrue_type#  AND a.acct_branch = #acct_branch# 
    	    	AND a.accrue_gl_code = #accrue_gl_code# AND a.analysis_state = '2' 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="sys_no" ref="GlDict.A.sys_no" jdbcType="VARCHAR" javaType="GlBaseType.U_SYSNO" mode="in" longname="系统编号" parameterType="condition"/>
            <parameter property="accrue_date" ref="GlDict.A.accrue_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="accrue_type" ref="GlDict.A.accrue_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_ACCRUETYPE" mode="in" longname="计提种类" parameterType="condition"/>
            <parameter property="acct_branch" ref="GlDict.A.acct_branch" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="账务机构" parameterType="condition"/>
            <parameter property="accrue_gl_code" ref="GlDict.A.accrue_gl_code" jdbcType="VARCHAR" javaType="GlBaseType.U_SUBJECTNO" mode="in" longname="计提科目" parameterType="condition"/>
            <parameter property="offset_gl_code" ref="GlDict.A.offset_gl_code" jdbcType="VARCHAR" javaType="GlBaseType.U_SUBJECTNO" mode="in" longname="对方科目" parameterType="condition"/>
        </parameterMap>
    </update>
    <select cache="none" method="selectOne" type="sql" id="cntAccountedSeq" longname="当日已汇总的会计事件流水总数">
        <sql type="db2"><![CDATA[
    	select
    	    	count(*) 
    	from
    	    	fab_accounting_seq 
    	where
    	    	corpno=#org_id# and trxn_date=#trxn_date# and trxn_seq_status <> '3' 
    	]]></sql>
        <sql type="oracle"><![CDATA[
    	select
    	    	count(*) 
    	from
    	    	fab_accounting_seq 
    	where
    	    	corpno=#org_id# and trxn_date=#trxn_date# and trxn_seq_status <> '3' 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	count(*) 
    	from
    	    	fab_accounting_seq 
    	where
    	    	corpno=#org_id# and trxn_date=#trxn_date# and trxn_seq_status <> '3' 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="cntCountLedgerCheckSeq" longname="当日总分核对流水总数">
        <sql type="oracle"><![CDATA[
    	select
    	    	count(*) 
    	from
    	    	fab_ledger_check_seq 
    	where
    	    	corpno=#org_id# and trxn_date =#trxn_date# and analysis_state <> '2'
    	]]></sql>
        <sql type="db2"><![CDATA[
    	select
    	    	count(*) 
    	from
    	    	fab_ledger_check_seq 
    	where
    	    	corpno=#org_id# and trxn_date =#trxn_date# and analysis_state <> '2'
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	count(*) 
    	from
    	    	fab_ledger_check_seq 
    	where
    	    	corpno=#org_id# and trxn_date =#trxn_date# and analysis_state <> '2'
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="cntCountLedgerCheckResult" longname="当日总分核对流水核对结果">
        <sql type="oracle"><![CDATA[
    	select
    	    	count(*) 
    	from
    	    	fab_ledger_check_result 
    	where
    	    	corpno=#org_id# and trxn_date =#trxn_date# and ledger_check_result <> '1'
    	]]></sql>
        <sql type="db2"><![CDATA[
    	select
    	    	count(*) 
    	from
    	    	fab_ledger_check_result 
    	where
    	    	corpno=#org_id# and trxn_date =#trxn_date# and ledger_check_result <> '1'
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	count(*) 
    	from
    	    	fab_ledger_check_result 
    	where
    	    	corpno=#org_id# and trxn_date =#trxn_date# and ledger_check_result <> '1'
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="cntCountAccrue" longname="获取计登记簿总笔数">
        <sql type="oracle"><![CDATA[
    	select
    	    	count(accrue_type) 
    	from
    	    	fab_accrue 
    	where
    	    	corpno=#org_id# and accrue_type=#accrue_type# and accrue_date=#accrue_date# and analysis_state in ('1','2','4')
    	]]></sql>
        <sql type="db2"><![CDATA[
    	select
    	    	count(accrue_type) 
    	from
    	    	fab_accrue 
    	where
    	    	corpno=#org_id# and accrue_type=#accrue_type# and accrue_date=#accrue_date# and analysis_state in ('1','2','4')
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	count(accrue_type) 
    	from
    	    	fab_accrue 
    	where
    	    	corpno=#org_id# and accrue_type=#accrue_type# and accrue_date=#accrue_date# and analysis_state in ('1','2','4')
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="accrue_type" ref="GlDict.A.accrue_type" jdbcType="VARCHAR" javaType="GlBusinessType.E_ACCRUETYPE" mode="in" longname="计提种类" parameterType="condition"/>
            <parameter property="accrue_date" ref="GlDict.A.accrue_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="计提日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="lstAccureSubject" longname="从计提登记簿中查询计提科目">
        <sql type="oracle"><![CDATA[
          
         	select
            distinct a.accrue_gl_code ,a.accrue_offset_gl_code
      from
            fab_accrue_accounting a 
      where
            a.accrue_branch=#accrue_branch# and a.accrue_date=#accrue_date# 
            and a.corpno=#org_id# and a.accrue_type in ('A','B')
      ]]></sql>
        <sql type="db2"><![CDATA[
          
         	select
            distinct a.accrue_gl_code ,a.accrue_offset_gl_code
      from
            fab_accrue_accounting a 
      where
            a.accrue_branch=#accrue_branch# and a.accrue_date=#accrue_date# 
            and a.corpno=#org_id# and a.accrue_type in ('A','B')
      ]]></sql>
        <sql type="mysql"><![CDATA[
          
         	select
            distinct a.accrue_gl_code ,a.accrue_offset_gl_code
      from
            fab_accrue_accounting a 
      where
            a.accrue_branch=#accrue_branch# and a.accrue_date=#accrue_date# 
            and a.corpno=#org_id# and a.accrue_type in ('A','B')
      ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="accrue_branch" ref="GlDict.A.accrue_branch" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="计提机构" parameterType="condition"/>
            <parameter property="accrue_date" ref="GlDict.A.accrue_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="计提日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="ComFaRegBook.FaAccureInfoms"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="cntCountOriginalVoch" longname="获取原始凭证科目号为空的总笔数">
        <sql type="oracle"><![CDATA[
    	select
    	    	count(trxn_date) 
    	from
    	    	fab_original_voch 
    	where
    	    	corpno=#org_id# and trxn_date =#trxn_date# and (gl_code is null or gl_code = '')
    	]]></sql>
        <sql type="db2"><![CDATA[
    	select
    	    	count(trxn_date) 
    	from
    	    	fab_original_voch 
    	where
    	    	corpno=#org_id# and trxn_date =#trxn_date# and (gl_code is null or gl_code = '')
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	count(trxn_date) 
    	from
    	    	fab_original_voch 
    	where
    	    	corpno=#org_id# and trxn_date =#trxn_date# and (gl_code is null or gl_code = '')
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="cntAccountedSceneSeq" longname="当日已汇总的场景事件流水总数">
        <sql type="mysql"><![CDATA[
    	select
    	    	count(*) 
    	from
    	    	fab_accounting_scene_seq 
    	where
    	    	corpno=#org_id# and trxn_date=#trxn_date# and trxn_seq_status <> '3' 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="cntCountLnLedgerCheckSeq" longname="当日贷款总分核对流水总数">
        <sql type="mysql"><![CDATA[
    	select
    	    	count(*) 
    	from
    	    	fab_lnledger_check_seq 
    	where
    	    	corpno=#org_id# and trxn_date =#trxn_date# and analysis_state <> '2'
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="cntCountlnLedgerCheckResult" longname="当日贷款总分核对流水核对结果">
        <sql type="mysql"><![CDATA[
    	select
    	    	count(*) 
    	from
    	    	fab_lnledger_check_result 
    	where
    	    	corpno=#org_id# and trxn_date =#trxn_date# and ledger_check_result <> '1'
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="org_id" ref="GlDict.A.org_id" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="trxn_date" ref="GlDict.A.trxn_date" jdbcType="VARCHAR" javaType="GlBaseType.U_DATE" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
</sqls>
