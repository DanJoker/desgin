<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sqls id="HcQuerySql" longname="热点账户查询类" package="cn.sunline.ltts.busi.hc.namedsql" xsi:noNamespaceSchemaLocation="ltts-model.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <dynamicSelect cache="none" method="selectAll" type="sql" id="listHcbLmocs" longname="查询n分钟以上额度占用表已占用的额度信息">
        <parameterMap class="java.util.Map">
            <parameter property="dealss" jdbcType="VARCHAR" javaType="HcEnumType.E_DEALSS" mode="in" longname="占用状态" parameterType="condition"/>
            <parameter property="tmstmp" jdbcType="VARCHAR" javaType="string" mode="in" longname="系统时间戳" parameterType="condition"/>
            <parameter property="timesd" jdbcType="VARCHAR" javaType="int" mode="in" longname="时间" parameterType="condition"/>
            <parameter property="hcblmo" jdbcType="VARCHAR" javaType="string" mode="in" parameterType="condition"/>
            <parameter property="hcbped" jdbcType="VARCHAR" javaType="string" mode="in" parameterType="condition"/>
            <parameter property="trandt" ref="BaseDict.Comm.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" ref="BaseDict.Comm.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="limict" jdbcType="VARCHAR" javaType="HcBaseType.U_INTEGE" mode="in" longname="查询条数" parameterType="condition"/>
        </parameterMap>
        <resultMap class="HcbLimitOccu.HcbLmoc"/>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[select *  from  ${hcblmo}]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[trandt = #trandt# and dealss = #dealss# and 
                 (#tmstmp#-tmstmp)/100 >=#timesd# and corpno = #corpno# and transq not in (
    	    	select transq from ${hcbped} where trandt = #trandt# and corpno=#corpno#)]]></str>
                </and>
            </where>
            <str type="Str"><![CDATA[order by transq,detlsq asc]]></str>
            <if test="limict!=null&amp;&amp;limict!=&quot;&quot;" type="If">
                <str type="Str"><![CDATA[limit ${limict}]]></str>
            </if>
        </dynamicSql>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[select * from ${hcblmo}]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[trandt = #trandt# and dealss = #dealss# and 
                (#tmstmp#-tmstmp)/100 >=#timesd# and corpno = #corpno# and transq not in (
    	    	select transq from ${hcbped} where trandt = #trandt# and corpno=#corpno#)]]></str>
                    <if test="limict!=null&amp;&amp;limict!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[rownum<=#limict#]]></str>
                    </if>
                </and>
            </where>
            <str type="Str"><![CDATA[order by transq,detlsq asc]]></str>
        </dynamicSql>
    </dynamicSelect>
    <dynamicSelect cache="none" method="selectAll" type="sql" id="selSumDoingBalList" longname="查询余额处理中汇总数据">
        <parameterMap class="java.util.Map">
            <parameter property="tbname" jdbcType="VARCHAR" javaType="string" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="HcTimerComplex.HcBalSum"/>
        <dynamicSql>
            <str type="Str"><![CDATA[
    	select sum(tranam * case  when amntcd ='D' then 1 else -1 end) as tranam,hcmain,hctype 
    	from ${tbname} 
		where trandt = #trandt# and corpno = #corpno# and detlss = 2
		group by hcmain,hctype
    	]]></str>
        </dynamicSql>
    </dynamicSelect>
    <dynamicSelect cache="none" method="selectAll" type="sql" id="selBalDetailList" longname="根据状态查询余额明细数据">
        <parameterMap class="java.util.Map">
            <parameter property="tbname" jdbcType="VARCHAR" javaType="string" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人号" parameterType="condition"/>
            <parameter property="detlss" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="修改后明细状态" parameterType="condition"/>
            <parameter property="dealtm" jdbcType="VARCHAR" javaType="HcBaseType.U_INTEGE" mode="in" longname="处理次数" parameterType="condition"/>
            <parameter property="limict" jdbcType="VARCHAR" javaType="HcBaseType.U_INTEGE" mode="in" longname="查询条数" parameterType="condition"/>
        </parameterMap>
        <resultMap class="HcbPendDeal.HcbPedl"/>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[select * from ${tbname}]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[corpno=#corpno#]]></str>
                    <if test="detlss!=null" type="If">
                        <str type="Str"><![CDATA[detlss=#detlss#]]></str>
                    </if>
                    <if test="dealtm!=null&amp;&amp;dealtm!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[dealtm>=#dealtm#]]></str>
                    </if>
                    <if test="trandt!=null&amp;&amp;trandt!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[trandt=#trandt#]]></str>
                    </if>
                </and>
            </where>
            <str type="Str"><![CDATA[order by tmstmp asc ]]></str>
            <if test="limict!=null&amp;&amp;limict!=&quot;&quot;" type="If">
                <str type="Str"><![CDATA[limit ${limict}]]></str>
            </if>
        </dynamicSql>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[select * from ${tbname}]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[corpno=#corpno#]]></str>
                    <if test="detlss!=null" type="If">
                        <str type="Str"><![CDATA[detlss=#detlss#]]></str>
                    </if>
                    <if test="dealtm!=null&amp;&amp;dealtm!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[dealtm>=#dealtm#]]></str>
                    </if>
                    <if test="trandt!=null&amp;&amp;trandt!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[trandt=#trandt#]]></str>
                    </if>
                    <if test="limict!=null&amp;&amp;limict!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[rownum<=#limict#]]></str>
                    </if>
                </and>
            </where>
            <str type="Str"><![CDATA[order by tmstmp asc]]></str>
        </dynamicSql>
    </dynamicSelect>
    <dynamicUpdate method="update" id="updHcbPedlStatus" longname="更新待处理余额明细状态">
        <parameterMap class="java.util.Map">
            <parameter property="tbname" jdbcType="VARCHAR" javaType="string" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="staftr" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="修改后明细状态" parameterType="condition"/>
            <parameter property="stbefr" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="修改前明细状态" parameterType="condition"/>
            <parameter property="limict" jdbcType="VARCHAR" javaType="HcBaseType.U_INTEGE" mode="in" longname="查询条数" parameterType="condition"/>
            <parameter property="hctype" jdbcType="VARCHAR" javaType="HcEnumType.E_HCTYPE" mode="in" longname="热点类型" parameterType="condition"/>
        </parameterMap>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[ update ${tbname} set detlss = #staftr#
  		where transq IN        
        (
        select * from 
        (
           select transq FROM ${tbname}]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[
                    corpno=#corpno# and detlss=#stbefr# and trandt=#trandt#]]></str>
                    <if test="hctype!=null" type="If">
                        <str type="Str"><![CDATA[ hctype!=#hctype#]]></str>
                    </if>
                </and>
            </where>
            <str type="Str"><![CDATA[order by tmstmp asc )]]></str>
            <where type="Where">
                <if test="limict!=null&amp;&amp;limict!=&quot;&quot;" type="If">
                    <str type="Str"><![CDATA[ rownum<=#limict#]]></str>
                </if>
            </where>
            <str type="Str"><![CDATA[)]]></str>
        </dynamicSql>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[update ${tbname} set detlss = #staftr#]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[corpno=#corpno#]]></str>
                    <if test="stbefr!=null" type="If">
                        <str type="Str"><![CDATA[detlss=#stbefr#]]></str>
                    </if>
                    <if test="trandt!=null&amp;&amp;trandt!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[trandt=#trandt#]]></str>
                    </if>
                     <if test="hctype!=null" type="If">
                        <str type="Str"><![CDATA[ hctype!=#hctype#]]></str>
                    </if>
                </and>
            </where>
            <str type="Str"><![CDATA[order by tmstmp asc ]]></str>
            <if test="limict!=null&amp;&amp;limict!=&quot;&quot;" type="If">
                <str type="Str"><![CDATA[limit ${limict}]]></str>
            </if>
        </dynamicSql>
    </dynamicUpdate>
    <dynamicUpdate method="update" id="updHcbPedlFailCountAndStatus" longname="更新待处理余额明细处理失败次数和状态">
        <parameterMap class="java.util.Map">
            <parameter property="tbname" jdbcType="VARCHAR" javaType="string" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="hcmain" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="热点主体号" parameterType="condition"/>
            <parameter property="staftr" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="修改后明细状态" parameterType="condition"/>
            <parameter property="stbefr" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="修改前明细状态" parameterType="condition"/>
        </parameterMap>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[
        update ${tbname} set dealtm = dealtm + 1, detlss = #staftr# 
        where trandt = #trandt# and corpno = #corpno# and hcmain = #hcmain# and detlss = #stbefr#
        ]]></str>
        </dynamicSql>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[
        update ${tbname} set dealtm = dealtm + 1, detlss = #staftr#
        where trandt = #trandt# and corpno = #corpno# and hcmain = #hcmain# and detlss = #stbefr#
        ]]></str>
        </dynamicSql>
    </dynamicUpdate>
    <insert id="transferFailTooMany" longname="待处理表失败次数达到上限转存到失败表">
        <sql type="mysql"><![CDATA[        
        insert into ${tbname} (corpno,trandt,cdcnno,transq,detlsq,hctype,amntcd,hcmain,tranam,nestyn,dealtm,detlss)
		select corpno,trandt,cdcnno,transq,detlsq,hctype,amntcd,hcmain,tranam,nestyn,0,detlss from ${hcbpel}
		where corpno = #corpno# and trandt = #trandt# and detlss = #detlss# and dealtm >= #failct#
        ]]></sql>
        <sql type="oracle"><![CDATA[        
        insert into ${tbname} (corpno,trandt,cdcnno,transq,detlsq,hctype,amntcd,hcmain,tranam,nestyn,dealtm,detlss)
		select corpno,trandt,cdcnno,transq,detlsq,hctype,amntcd,hcmain,tranam,nestyn,0,detlss from ${hcbpel}
		where corpno = #corpno# and trandt = #trandt# and detlss = #detlss# and dealtm >= #failct#
    	group By cabrdt,brchno,acctcd,crcycd]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="tbname" jdbcType="VARCHAR" javaType="string" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="hcbpel" jdbcType="VARCHAR" javaType="string" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="failct" jdbcType="INTEGER" javaType="BaseType.U_LONGIN" mode="in" longname="重试次数" parameterType="condition"/>
            <parameter property="detlss" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="明细状态" parameterType="condition"/>
        </parameterMap>
    </insert>
    <dynamicDelete method="delete" id="delFailTooMany" longname="失败次数达到上限 从待处理表删除">
        <parameterMap class="java.util.Map">
            <parameter property="tbname" jdbcType="VARCHAR" javaType="string" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="failct" jdbcType="INTEGER" javaType="BaseType.U_LONGIN" mode="in" longname="重试次数" parameterType="condition"/>
            <parameter property="detlss" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="明细状态" parameterType="condition"/>
        </parameterMap>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[
        delete from ${tbname} where corpno = #corpno# and trandt = #trandt# and detlss = #detlss# and dealtm >= #failct#
        ]]></str>
        </dynamicSql>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[
        delete from ${tbname} where corpno = #corpno# and trandt = #trandt# and detlss = #detlss# and dealtm >= #failct#
        ]]></str>
        </dynamicSql>
    </dynamicDelete>
    <dynamicSelect cache="none" method="selectAll" type="sql" id="SelHcbFlDl" longname="查询失败明细表">
        <parameterMap class="java.util.Map">
            <parameter property="tbname" jdbcType="VARCHAR" javaType="string" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="detlss" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="明细状态" parameterType="condition"/>
        </parameterMap>
        <resultMap class="HcbPendDeal.HcbPedl"/>
        <dynamicSql>
            <str type="Str"><![CDATA[select * from ${tbname} where detlss=#detlss#]]></str>
        </dynamicSql>
    </dynamicSelect>
    <dynamicUpdate method="update" id="updHcbPedlSyncstZtO" longname="修改待同步的待处理明细为同步中">
        <parameterMap class="java.util.Map">
            <parameter property="tablename" jdbcType="VARCHAR" javaType="BaseType.U_CHAR20" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="limict" jdbcType="VARCHAR" javaType="HcBaseType.U_INTEGE" mode="in" longname="查询条数" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[update ${tablename}  set syncst='1',detlss='5'  where syncst='0' and hctype='3' and corpno=#corpno# order by tmstmp asc]]></str>
            <if test="limict!=null&amp;&amp;limict!=&quot;&quot;" type="If">
                <str type="Str"><![CDATA[limit ${limict}]]></str>
            </if>
        </dynamicSql>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[
            update ${tablename} set syncst='1',detlss='5' 
  		where transq IN        
        (
        select * from 
        (
           select transq FROM ${tablename} where syncst='0' and hctype='3' and corpno=#corpno#         
           order by tmstmp asc
        )]]></str>
            <where type="Where">
                <if test="limict!=null&amp;&amp;limict!=&quot;&quot;" type="If">
                    <str type="Str"><![CDATA[ rownum<=#limict#]]></str>
                </if>
            </where>
            <str type="Str"><![CDATA[)]]></str>
        </dynamicSql>
    </dynamicUpdate>
    <dynamicSelect cache="none" method="selectAll" type="sql" id="listHcbPedl" longname="查询热点待处理明细表">
        <parameterMap class="java.util.Map">
            <parameter property="tablename" jdbcType="VARCHAR" javaType="BaseType.U_CHAR20" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="limict" jdbcType="VARCHAR" javaType="HcBaseType.U_INTEGE" mode="in" longname="查询条数" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="HcbPendDeal.HcbPedl"/>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[select trandt,cdcnno,transq,detlsq,hctype,amntcd,hcmain,tranam,nestyn,
            dealtm,'1' as detlss,syncst,tmstmp,corpno from ${tablename} where syncst='1' 
            and corpno=#corpno# and hctype='3' order by tmstmp asc limit ${limict} ]]></str>
        </dynamicSql>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[select trandt,cdcnno,transq,detlsq,hctype,amntcd,hcmain,tranam,nestyn,
            dealtm,'1' as detlss,syncst,tmstmp,corpno from (select * from ${tablename} where 
            corpno = #corpno# and syncst='1' and hctype='3' order by tmstmp asc)]]></str>
            <where type="Where">
                <if test="limict!=null&amp;&amp;limict!=&quot;&quot;" type="If">
                    <str type="Str"><![CDATA[ rownum<=#limict#]]></str>
                </if>
            </where>      
        </dynamicSql>
    </dynamicSelect>
    <dynamicUpdate method="update" id="updHcbPedlSyncstOtT" longname="修改同步中的待处理明细为已同步">
        <parameterMap class="java.util.Map">
            <parameter property="tablename" jdbcType="VARCHAR" javaType="BaseType.U_CHAR20" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="limict" jdbcType="VARCHAR" javaType="HcBaseType.U_INTEGE" mode="in" longname="查询条数" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[update ${tablename} set syncst='2' where syncst='1' and hctype='3' and corpno=#corpno# order by tmstmp asc limit ${limict}]]></str>
        </dynamicSql>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[
         update ${tablename} set syncst='2' 
  		where transq IN        
        (
        select * from 
        (
           select transq FROM ${tablename} where syncst='1' and hctype='3' and corpno=#corpno#         
           order by tmstmp asc
        )]]></str>
            <where type="Where">
                <if test="limict!=null&amp;&amp;limict!=&quot;&quot;" type="If">
                    <str type="Str"><![CDATA[ rownum<=#limict#]]></str>
                </if>
            </where>
            <str type="Str"><![CDATA[)]]></str>
        </dynamicSql>
    </dynamicUpdate>
    <select cache="none" method="selectOne" type="sql" id="selHcbBlceDetl" longname="查询余额明细表最近记录">
        <sql type="mysql"><![CDATA[
		select * from hcb_blce_detl where corpno = #corpno# and hcacct = #hcmain# order by transq desc limit 1
		]]></sql>
        <sql type="oracle"><![CDATA[
		select * from (select * from hcb_blce_detl where corpno = #corpno# and hcacct = #hcmain# order by transq desc) 
		where rownum = 1 
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
            <parameter property="hcmain" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="热点主体号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="HotCtrl.HcbBlceDetl"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selHcbBlceList" longname="查询余额表记录">
        <sql type="mysql"><![CDATA[
		select * from hcb_blce where corpno = #corpno# and trandt = #trandt# 
		]]></sql>
        <sql type="oracle"><![CDATA[
		select * from hcb_blce where corpno = #corpno# and trandt = #trandt# 
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="HotCtrl.HcbBlce"/>
    </select>
    <dynamicSelect cache="none" method="selectAll" type="sql" id="SelHcbFldlSum" longname="查询失败明细表轧差">
        <parameterMap class="java.util.Map">
            <parameter property="tbname" jdbcType="VARCHAR" javaType="string" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="detlss" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="明细状态" parameterType="condition"/>
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="HcTimerComplex.HcBalSum"/>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[select sum(tranam *  case  when amntcd ='D' then 1 else -1 end) as tranam,hcmain,hctype from ${tbname}]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[corpno=#corpno#]]></str>
                    <if test="detlss!=null" type="If">
                        <str type="Str"><![CDATA[detlss=#detlss#]]></str>
                    </if>
                    <if test="trandt!=null&amp;&amp;trandt!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[trandt=#trandt#]]></str>
                    </if>
                </and>
            </where>
            <str type="Str"><![CDATA[group by hcmain,hctype ]]></str>
        </dynamicSql>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[select sum(tranam *  case  when amntcd ='D' then 1 else -1 end) as tranam,hcmain,hctype from ${tbname}]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[corpno=#corpno#]]></str>
                    <if test="detlss!=null" type="If">
                        <str type="Str"><![CDATA[detlss=#detlss#]]></str>
                    </if>
                    <if test="trandt!=null&amp;&amp;trandt!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[trandt=#trandt#]]></str>
                    </if>
                </and>
            </where>
            <str type="Str"><![CDATA[group by hcmain,hctype]]></str>
        </dynamicSql>
    </dynamicSelect>
    <dynamicUpdate method="update" id="UpdHcbFldlStatus" longname="更新失败明细表明细状态">
        <parameterMap class="java.util.Map">
            <parameter property="tbname" jdbcType="VARCHAR" javaType="string" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="detlss" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="后明细状态" parameterType="condition"/>
            <parameter property="detlbs" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="前明细状态" parameterType="condition"/>
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="limict" jdbcType="VARCHAR" javaType="HcBaseType.U_INTEGE" mode="in" longname="查询条数" parameterType="condition"/>
        </parameterMap>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[update ${tbname} set detlss=#detlss# ]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[corpno=#corpno#]]></str>
                    <if test="detlss!=null" type="If">
                        <str type="Str"><![CDATA[detlss=#detlbs#]]></str>
                    </if>
                </and>
            </where>
            <str type="Str"><![CDATA[order by tmstmp asc ]]></str>
            <if test="limict!=null&amp;&amp;limict!=&quot;&quot;" type="If">
                <str type="Str"><![CDATA[limit ${limict}]]></str>
            </if>
        </dynamicSql>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[update ${tbname} set detlss=#detlss#  
            where transq IN        
        (
        select * from 
        (
           select transq FROM ${tbname} where corpno=#corpno# and detlss=#detlbs#           
           order by tmstmp asc
        )]]></str>
            <where type="Where">
                <if test="limict!=null&amp;&amp;limict!=&quot;&quot;" type="If">
                    <str type="Str"><![CDATA[ rownum<=#limict#]]></str>
                </if>
            </where>
            <str type="Str"><![CDATA[)]]></str>
        </dynamicSql>
    </dynamicUpdate>
    <dynamicUpdate method="update" id="UpdHcbFldlCount" longname="更改失败明细表失败次数">
        <parameterMap class="java.util.Map">
            <parameter property="tbname" jdbcType="VARCHAR" javaType="string" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="detlss" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="后明细状态" parameterType="condition"/>
            <parameter property="detlbs" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="前明细状态" parameterType="condition"/>
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <dynamicSql>
            <str type="Str"><![CDATA[update ${tbname} set dealtm=dealtm+1,detlss=#detlss#  where detlss=#detlbs# 
and trandt=#trandt# and  corpno=#corpno# 
        ]]></str>
        </dynamicSql>
    </dynamicUpdate>
    <dynamicUpdate method="update" id="UpdHcbFldlSsToFail" longname="更改失败明细表失败状态">
        <parameterMap class="java.util.Map">
            <parameter property="tbname" jdbcType="VARCHAR" javaType="string" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="dealtm" jdbcType="VARCHAR" javaType="HcBaseType.U_INTEGE" mode="in" longname="处理次数" parameterType="condition"/>
            <parameter property="detlss" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="明细状态" parameterType="condition"/>
            <parameter property="detlbs" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="前明细状态" parameterType="condition"/>
            <parameter property="limict" jdbcType="VARCHAR" javaType="HcBaseType.U_INTEGE" mode="in" longname="查询条数" parameterType="condition"/>
        </parameterMap>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[update ${tbname} set detlss=#detlss# ]]></str>
            <where type="Where">
                <and type="And">
                    <if test="detlbs!=null" type="If">
                        <str type="Str"><![CDATA[detlss=#detlbs#]]></str>
                    </if>
                    <if test="dealtm!=null&amp;&amp;dealtm!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[dealtm>=#dealtm#]]></str>
                    </if>
                </and>
            </where>
            <str type="Str"><![CDATA[order by tmstmp asc ]]></str>
            <if test="limict!=null&amp;&amp;limict!=&quot;&quot;" type="If">
                <str type="Str"><![CDATA[limit ${limict}]]></str>
            </if>
        </dynamicSql>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[update ${tbname} set detlss=#detlss#       
                where transq IN        
        (
        select * from 
        (
           select transq FROM ${tbname} where corpno=#corpno# and detlss=#detlbs#  
           and dealtm >=#dealtm#
           order by tmstmp asc
        )]]></str>
            <where type="Where">
                <if test="limict!=null&amp;&amp;limict!=&quot;&quot;" type="If">
                    <str type="Str"><![CDATA[ rownum<=#limict#]]></str>
                </if>
            </where>
            <str type="Str"><![CDATA[)]]></str>
        </dynamicSql>
    </dynamicUpdate>
    <dynamicSelect cache="none" method="selectAll" type="sql" id="SelHcbFldlListByStatus" longname="根据明细状态查询明细">
        <parameterMap class="java.util.Map">
            <parameter property="tbname" jdbcType="VARCHAR" javaType="string" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="detlss" jdbcType="VARCHAR" javaType="HcEnumType.E_DETLSS" mode="in" longname="后明细状态" parameterType="condition"/>
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="HcbFailDetl.HcbFldl"/>
        <dynamicSql>
            <str type="Str"><![CDATA[select * from ${tbname} where trandt = #trandt# and corpno = #corpno# and detlss = #detlss# 
order by tmstmp asc]]></str>
        </dynamicSql>
    </dynamicSelect>
    <insert id="initHcbBlceCL" longname="初始化额度余额表">
        <sql type="mysql"><![CDATA[        
        insert into hcb_blce(corpno,hcacct,balnce,amntcd,lsblce,trandt,lastdt)
		select corpno,hcmain,0,'C',0,#trandt#,#lastdt# from Hcp_Defn
        ]]></sql>
        <sql type="oracle"><![CDATA[        
        insert into hcb_blce(corpno,hcacct,balnce,amntcd,lsblce,trandt,lastdt)
		select corpno,hcmain,0,'C',0,#trandt#,#lastdt# from Hcp_Defn
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="lastdt" jdbcType="INTEGER" javaType="BaseType.U_DATE08" mode="in" longname="上日日期" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectAll" type="sql" id="listHcpDefnExpidt" longname="查询生效失效日期为当前交易日期热点定义表信息">
        <sql><![CDATA[
    	select
    	    	hcmain, expidt ,effcdt 
    	from
    	    	hcp_defn 
    	where
    	    	corpno=#corpno# and (
    	    	    	effcdt = #trandt# or expidt = #trandt#
    	    	) 
    	order by
    	    	gropnm,hcmain 
    	]]></sql>
        <sql type="oracle"><![CDATA[
    	select
    	    	hcmain, expidt ,effcdt 
    	from
    	    	hcp_defn 
    	where
    	    	corpno=#corpno# and (
    	    	    	effcdt = #trandt# or expidt = #trandt#
    	    	) 
    	order by
    	    	gropnm,hcmain 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	hcmain, expidt ,effcdt 
    	from
    	    	hcp_defn 
    	where
    	    	corpno=#corpno# and (
    	    	    	effcdt = #trandt# or expidt = #trandt#
    	    	) 
    	order by
    	    	gropnm,hcmain 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="BaseDict.Comm.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" ref="BaseDict.Comm.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="HotCtrl.HcpDefn"/>
    </select>
    <dynamicSelect cache="none" method="selectOne" type="sql" id="SelHcbPedlSync" longname="查询同步中数据">
        <parameterMap class="java.util.Map">
            <parameter property="tbname" jdbcType="VARCHAR" javaType="string" mode="in" longname="表名" parameterType="condition"/>
        </parameterMap>
        <resultMap class="BaseType.U_LONGIN"/>
        <dynamicSql>
            <str type="Str"><![CDATA[select count(1) from  ${tbname} where SYNCST='1']]></str>
        </dynamicSql>
    </dynamicSelect>
</sqls>
