<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sqls xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="ApHistNSQL" longname="数据转储命名SQL" package="cn.sunline.edsp.busi.bsap.namedsql" xsi:noNamespaceSchemaLocation="ltts-model.xsd">
    <select cache="none" method="selectOne" type="sql" id="getPartitionFromSyscat" longname="从系统编目表中查询分区信息">
        <sql><![CDATA[
    	select
    	    	a.datapartitionname table_partition_name 
    	from
    	    	syscat.DATAPARTITIONS a 
    	where
    	    	a.tabname = #tablna# and a.datapartitionname = #partna# 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	a.partition_name table_partition_name 
    	from
    	    	information_schema.partitions a
    	where
    	    	a.TABLE_NAME = #tablna# and a.partition_name = #partna#
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="tablna" ref="BaseDict.Comm.tablna" jdbcType="VARCHAR" javaType="BaseType.U_TABLENAME" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="partna" ref="BaseDict.Comm.partna" jdbcType="VARCHAR" javaType="BaseType.U_CHAR18" mode="in" longname="表分区名称" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.lang.String"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="listPartitionInfosBeforePtname" longname="查询指定分区之前的表分区">
        <sql><![CDATA[
    	select
    	    	a.datapartitionname table_partition_name 
    	from
    	    	syscat.DATAPARTITIONS a 
    	where
    	    	a.TABNAME = #tablna# and a.datapartitionname < #partna# 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	a.partition_name table_partition_name 
    	from
    	    	information_schema.partitions a 
    	where
    	    	a.TABLE_NAME = #tablna# and a.partition_name < #partna#
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="tablna" ref="BaseDict.Comm.tablna" jdbcType="VARCHAR" javaType="BaseType.U_TABLENAME" mode="in" longname="表名" parameterType="condition"/>
            <parameter property="partna" ref="BaseDict.Comm.partna" jdbcType="VARCHAR" javaType="BaseType.U_CHAR18" mode="in" longname="表分区名称" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.lang.String"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="getOldestPartitionName" longname="获取该表最前面的表分区">
        <sql><![CDATA[    	select
    	    	a.partition_name table_partition_name 
    	from
    	    	information_schema.partitions a 
    	where
    	    	a.TABLE_NAME = #tablna# ORDER BY a.PARTITION_NAME ASC LIMIT 1 ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="tablna" ref="BaseDict.Comm.tablna" jdbcType="VARCHAR" javaType="BaseType.U_TABLENAME" mode="in" longname="表名" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.lang.String"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="getNewestPartitionName" longname="获取该表最新创建的表分区">
        <sql><![CDATA[    	select
    	    	a.partition_name table_partition_name 
    	from
    	    	information_schema.partitions a 
    	where
    	    	a.TABLE_NAME = #tablna# ORDER BY a.PARTITION_NAME DESC LIMIT 1 ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="tablna" ref="BaseDict.Comm.tablna" jdbcType="VARCHAR" javaType="BaseType.U_TABLENAME" mode="in" longname="表名" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.lang.String"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="listMspDataClean" longname="查询清理数据列表">
        <sql><![CDATA[select table_name, table_desc, partition_mode, history_flag, history_table_name from app_data_clean]]></sql>
        <parameterMap class="java.util.Map"/>
        <resultMap class="ApHistTable.AppDataClean"/>
    </select>
</sqls>
